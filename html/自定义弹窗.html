{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="minimal-ui">
    <meta name="viewport"
          content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta name="screen-orientation" content="portrait"><!-- uc强制竖屏 -->
    <meta name="x5-orientation" content="portrait"><!-- QQ强制竖屏 -->
    <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'load_set/css/pullToRefresh.css' %}">
    <link rel="stylesheet" href="{% static 'load_set/css/reset.css' %}">
    <script src="{% static 'js/jquery.js' %}"></script>
    <script src="{% static 'bootstrap/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'load_set/js/iscroll.js' %}"></script>
    <script src="{% static 'load_set/js/pullToRefresh.js' %}"></script>
    <script src="{% static 'load_set/js/pullToRefresh.mini.js' %}"></script>
    <title>福利中心-游戏内</title>
    <style>
        /*设置IOS页面长按不可复制粘贴，但是IOS上出现input、textarea不能输入，因此将使用-webkit-user-select:auto;*/
        * {
            -webkit-touch-callout: none; /*系统默认菜单被禁用*/
            -webkit-user-select: none; /*webkit浏览器*/
            -khtml-user-select: none; /*早期浏览器*/
            -moz-user-select: none; /*火狐*/
            -ms-user-select: none; /*IE10*/
            user-select: none;
        }

        html, body, .task_body, .task_body_gf, .task_body_xs {
            /*height: 98%;*/
        }

        body {

            background: #222A5F;
            text-align: -webkit-center;
        }

        hr {
            margin: 12px 0;
            border-color: #4C64B8;
        }

        .hr_red {
            border: 2px solid transparent;
            margin: 0;
        }

        .top {
            color: white;
            text-align: center;
            top: 0;
            position: fixed;
            width: 100%;
            background-color: #222A5F;
        }

        .top_new {
            display: none;
        }

        .top_name {
            font-size: 16px;
        }

        .top_task {
            display: inline-block;
            margin: 0 18px;
        }

        .top_name {
            color: #FFFFFF;
            display: inline-block;
            float: left;
        }

        .top_name > a {
            text-decoration: none;
        }

        .top_new {
            color: white;
            background-color: #E25050;
            display: inline-block;
            padding: 1px 5px;
            border-radius: 25px 25px 25px 0;
            font-size: 11px;
            position: absolute;
            margin-top: -15px;
        }

        .task_body {
            /* margin-top: -8px; */
            background-color: #222A5F;
        }

        .top_task > .top_bottom {
            background-color: #FFF;
            width: 30px;
            height: 3px;
            margin: 10px auto;
            border-radius: 20px;
        }

        .task {
            background-color: #222A5F;
            width: 90%;
            border-radius: 10px;
            margin: 8px 0;
        }

        .task_jindu {
            font-size: 11px;
            color: #94ABF8;
            margin-top: 3px;
        }

        .cheng_zhuo {
            display: flex;
            padding: 18px 0 26px 14px;
            background: linear-gradient(0deg, #2B3F86, #3C54AB);
            border-radius: 7px;
        }

        .task_img_icon {
            width: 55px;
            margin: 0 10px 14px 0;
        }

        .task_jieshao {
            text-align: left;
            padding-top: 5px;
        }

        .task_title {
            color: #fff;
            display: inline-block;
        }

        .task_lingqu {
            color: #000;
            background-color: #FFD200;
            display: inline-block;
            padding: 1px 5px;
            border-radius: 25px 25px 25px 0;
            font-size: 11px;
            float: right;
            margin-top: -15px;
        }

        .task_sub_title {
            color: #BBE0FF;
            margin-top: 7px;
            font-size: 12px;
        }

        .task_reward {
            align-self: center;
            margin-left: auto;
            width: 100px;
            text-align: left;
            font-size: 11px;
            margin-bottom: 10px;
        }

        .task_img {
            width: 15px;
            margin-bottom: 3px;
        }

        .chevron_down {
            text-align: center;
            color: #7490F9;
            margin: -30px 0 20px 0;
            border-top: 1px solid #4C64B8;
            padding-top: 4px;
            width: 90%;
        }

        .task_child {
            /* overflow-y: auto; */
            /* max-height: 215px; */
            text-align: left;
            padding: 16px;
            padding-bottom: 0;
        }

        .task_name {
            font-size: 15px;
            color: #BFCDFF;
        }

        .task_child_btn {
            float: right;
            margin-top: -33px;
            text-align: center;
        }

        .task_child_btn > img {
            width: 70px;
        }

        .task_child_btn > div {
            margin-top: -22px;
            color: white;
            font-size: 12px;
        }

        .task_child > hr {
            margin: 10px 0;
            border-color: #4C64B8;
        }

        .chevron_up {
            text-align: center;
            color: #808080;
            margin-top: -10px;
        }

        .chevron_up > div {
            font-size: 10px;
        }

        .chevron_down > img, .chevron_up > img {
            width: 14px;
        }

        .modal-dialog {
            position: absolute;
            top: 50%;
            transform: translateY(-50%) !important;
            min-width: 94%;
        }

        .modal_top {
            padding: 15px;
            color: white;
            padding-bottom: 0;
        }

        .modal_top_1 {
            font-size: 16px;
            text-align: center;
            padding-bottom: 5px;
        }

        .modal_top_2 {
            font-size: 12px;
            color: #B6BFFF;
        }

        .modal_body {
        {#background-color: white;#} padding: 15px;
            border-radius: 0 0 6px 6px;
            text-align: left;
            color: white;
        }

        .modal_schedule {
            font-size: 12px;
        }

        .modal_body > div {
        {#margin: 7px 0;#}
        }

        .modal_body > div > div {
        {#margin: 7px 0;#}
        }

        .modal_body_g {
            background: #2F387B;
            border-radius: 7px;
            padding: 11px;
        }

        .modal_btn > img {
            width: 110px;
            height: 34px;
        }

        .modal_btn > div {
            margin-top: -26px;
            color: white;
        }

        .modal_jiangli {
            font-size: 14px;
            color: #FFCC00;
            margin: 10px 0 !important;
        }

        .modal_zhouqi {
            font-size: 11px;
            color: #B6BFFF;
            margin: 10px 0 -6px 0 !important;
        }

        .modal_end_time {
            font-size: 11px;
            color: #B6BFFF;
            margin: 20px 0 0 0 !important;
        }

        .modal_wanjia > div {
            display: inline-block;
            width: 50%;
            font-size: 11px;
        }

        .jindutiao {
            background-color: #94AAF8;
            width: 30px;
            height: 4px;
            margin: 2px 4px;
            border-radius: 2px;
            display: inline-block
        }

        .jindutiao_1 {
            background-color: #F1BC3C;
            width: 0;
            max-width: 100%;
            height: 4px;
            border-radius: 5px;
            float: left
        }

        .renwu_jindu {
            padding-bottom: 30px;
            text-align: left;
        }

        .renwu_biaoti {
            width: 40px;
            display: inline-block;
        }

        .sp_jindu {
            background-color: #4F59A3;
            width: 70%;
            height: 5px;
            border-radius: 5px;
            position: absolute;
            display: inline-block;
        }

        .sp_jindu_1 {
            background-color: #FFCC00;
            width: 20%;
            max-width: 100%;
            height: 5px;
            border-radius: 5px;
        }

        .sp_jindu_2 {
            margin-top: -7px;
            font-size: 10px;
        }

        .sp_jindu_2_1 {
            display: inline-block;
            position: absolute;
            margin-left: 0;
        }

        .sp_jindu_2_1_1 {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #4F59A3;
        }

        .sp_jindu_2_1_2 {
            width: 40px;
            margin-top: 7px;
        }

        .sp_jindu_3 {
            position: absolute;
            margin-top: -5px;
            margin-left: -5px;
        }

        .sp_jindu_2_img {
            width: 22px;
        }

        .modal-content {
            box-shadow: 0 0 black;
        }

        .myModal_content_1 {
            /* box-shadow: 0 0 22px rgba(0, 0, 0, 0.3); */
            width: 94%;
            margin: 0 auto;
            /* border-radius: 14px; */
            background-color: #3D4793;
        }

        .close {
            font-size: 34px;
            height: 34px;
            opacity: .5;
            margin-top: -14px;
        }

        .img_card {
            width: 16px;
            margin-bottom: 3px;
        }

        #viewer {
            width: 36rem;
            max-width: 100%;
        }

        .stage_1 {
        {#margin-top: -21rem;#}
        }

        .stage_1 > img {
            width: 5rem;
            max-width: 15%;
        }

        .stage_2 {
            margin-top: 2rem;
        }

        .stage_2 > img {
            width: 10rem;
            max-width: 30%;
        }

        .stage_2 > div {
            color: white;
            margin-top: -2.7rem;
        }

        .table {
            font-size: 10px;
        }

        .thead {
            display: flex;
            background-color: #4A57B3;
            border-radius: 5px 5px 0 0;
            color: #D1D7FF;
        }

        .thead_th {
            /* width: 20%; */
            /* text-align: center; */
            min-height: 34px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1; /* 父级flex布局，子元素用这个平分宽度 */
        }

        .table_1 {
            border-radius: 6px;
            border: 1px solid #4A57B3;
        }

        .table_2 {
            border-radius: 6px;
            border: 1px solid #4A57B3;
        }

        .tbody_tr {
            min-height: 34px;
            display: flex;
            /* flex-direction: row; */
            /* width: 101%; */
        }

        .tbody_td {
            /* width: 20%; */
            text-align: center;
            /* display: inline-block; */
            vertical-align: middle;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
        }

        .tbody {
            overflow-y: auto;
            max-height: 140px;
            border-radius: 0 0 6px 6px;
        }

        .tbody > .tbody_tr:nth-of-type(odd) {
            background-color: #212963;
        }

        .tbody > .tbody_tr:nth-of-type(even) {
            background-color: #3F4993;
        }

        .btn_list {
            width: 160px;
            border: 1px solid #FFCC00;
            border-radius: 5px;
            display: flex;
            margin: 0 auto 20px !important;
        }

        .btn_list > div {
            text-align: center;
            vertical-align: middle;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
        }

        .table_2 {
            display: none;
        }

        .btn_list_selected {
            background-color: #FFCC00;
            color: #000;
        }

        .btn_list_unselected {
        {#background-color: white;#} color: #FFCC00;
        }

        .btn_list_v1 {
            border-radius: 4px 0 0 4px;
        }

        .btn_list_v2 {
            border-radius: 0 4px 4px 0;
        }

        .modal_hand_data > div {
            display: inline-block;
            width: 49%;
            color: #FFFEFE;
            font-size: 12px;
            margin: 0 !important;
        }

        .div_progress_val {
            width: 90px;
            background-image: url('{{ request.MEDIA_CDN }}/static/img/task/game/news.png?v=1.0');
            background-repeat: no-repeat; /*不重复*/
            background-size: 100%;
            font-size: 10px;
            text-align: center;
            padding: 7px 0 13px 0;
            color: #000;
        }

        .no_task {
            display: flex;
            height: 100%;
            color: #767FB8;
        }

        .no_task > div {
            align-self: center;
            flex: 1;
        }

        .no_task > div > img {
            width: 80px;
            margin-bottom: 10px;
        }

        .pool_number_v > img {
            width: 5%
        }

        /*平板*/
        @media screen and (min-width: 600px) {
            .pool_number_v > img {
                width: 5%
            }

            .task_body {
                margin-top: -40px;
            }

        }

        .bottom_v {
            position: fixed;
            color: white;
            bottom: 0;
            font-size: 14px;
            width: 100%;
            background-color: #222A5F;
            line-height: 5rem;
        }

        .bottom_v > div {
            display: inline-block;
            margin: 0 4rem;
        }

        .bottom_v > div > img {
            width: 1.1rem;
            margin-bottom: 2px;
        }

        .bottom_v > div > span {
            border-bottom: 1px solid;
        }

        .modal_dialog_error {
            display: inline-block;
            background: #000000;
            opacity: 0.7;
            border-radius: 5px;
            color: #FFFFFF;
            line-height: 35px;
            max-width: 150px;
            padding: 5px 16px;

        }

        .jiangli_type {
            top: 56%;
            transform: translateY(-50%) !important;
            position: absolute;
            width: 100%;
        }

        .task_min_div {
            background-color: rgb(38, 58, 124);
            border-radius: 7px;
            margin-top: -10px;
        }

        .myModal_official > .cheng_zhuo {
            background: none;
            border-radius: 0;
        }

        .myModal_official {
            background: linear-gradient(0deg, #2B3F86, #3C54AB);
            border-radius: 7px;
        }

        #caichi_level {
            font-size: 15px;
            padding: 7px;
        }

        .zonglan_dialog {
            background: #3D4793;
            border-radius: 7px;
            padding: 10px;
            color: white;
            width: 94%;
        }

        .zonglan_zongcaichi {
            font-size: 16px;
        }

        .zonglan_zongcaichi_img {
            margin-bottom: 12px;
        }

        .zonglan_zongcaichi_img > img {
            width: 20px;
        }

        .zonglan_caichi {
            font-size: 11px;
        }

        .zonglan_caichi > div {
            display: inline-block;
            width: 31.5%;
        }

        .zonglan_caichi > div > div > img {
            width: 16px;
        }

        .zonglan_text {
            background: #2F387B;
            border-radius: 7px;
            text-align: left;
            padding: 10px;
            margin-top: 10px;
        }

        .zonglan_text > div {

        }

        .zonglan_text > div > div > img {
            width: 4px;
            margin-bottom: 3px;
        }

        .zonglan_text > div > div:nth-child(1) {
            font-size: 14px;
            color: #F5DA98;
            margin: 5px 0 2px 0;
        }

        .zonglan_text > div > div:nth-child(2) {
            font-size: 10px;
            color: #B4BEFA;
        }

        .jilu_modal {
            border-radius: 7px;
            background: #3D4793;
            color: white;
            width: 94%;
        }

        .jilu_top {
            font-size: 15px;
            padding: 1rem 0;
        }

        .jilu_top_v2 > img {
            width: 16rem;
        }

        .jilu_top_v2 > div {
            margin-top: -3.5rem;
        }

        .jilu_top_v3 {
            line-height: 4.5rem;
            background: #FFCC00;
            border-radius: 7px;
            width: 90%;
            color: #000;
        }

        .jilu_top_v3 > div {
            display: inline-block;
            width: 27%;
        }

        .jilu_top_v3 > div:nth-child(1) {
            text-align: start;
        }

        .jilu_top_v3 > div:nth-child(3) {
            text-align: end;
        }

        .jilu_data {
            background: #2F387B;
            border-radius: 7px;
            width: 90%;
            margin-top: 1rem;
        }

        .jilu_data > div:nth-child(1) {
            line-height: 3.5rem;
            background: #4C56A6;
            border-radius: 7px 7px 0 0;
        }

        .jilu_data > div:nth-child(1) > div {
            display: inline-block;
            width: 32%;
        }

        #wrapper {
            position: static;
            background: none;
            max-height: 24rem;
        }

        .scroller {
            position: static;
        }

        .pullDown, .pullUp {
            background: none;
        }

        .jilu_bottom {
            font-size: 10px;
            color: #A8B1F9;
            line-height: 4rem;
        }

        .scroller {
        {#margin-top: -40px;#}
        }

        .pullDownLabel img {
            width: 13px;
            height: 13px;
            margin-top: -1px;
            vertical-align: -2px;
            margin-right: 5px;
        }

        .table_data > div {
            display: inline-block;
            width: 32%;
            text-align: center;
        }

        .scroller li {
            padding: 10px;
            color: #B4BEFA;
            font-size: 12px;
        }


        #background {
            {#display: none;#}
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        #div1 {
            width: 90%;
            z-index: 1;
            overflow: auto;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            margin: 0 5%;
        }


    </style>
</head>
<body class="body_v">

<div class="top">
    <div id="caichi_level">大彩池</div>
    <div class="pool_number">
        <img style="width: 90%" src="{{ request.MEDIA_CDN }}/static/img/task/game/poolGifImage.png?v=1.0">
        <div class="pool_number_v">
            <img src="{{ request.MEDIA_CDN }}/static/img/task/game/number/money.png?v=1.0">

        </div>
    </div>
    <div>
        <div class="top_task top_task_v1">
            {#            <div class="top_text">#}
            <div class="top_name top_name_v1">彩池任务</div>
            <div class="top_new lottery_bubble_desc"></div>
            {#            </div>#}
            <br/>
            <div class="top_bottom top_bottom_v1"></div>
        </div>
        <div class="top_task top_task_v2">
            {#            <div class="top_text">#}
            <div class="top_name top_name_v2" style="color: #A2ABED">官方任务</div>
            <div class="top_new official_bubble_desc"></div>
            {#            </div>#}
            <br/>
            <div class="top_bottom top_bottom_v2" hidden></div>
        </div>
        <div class="top_task top_task_v3">
            {#            <div class="top_text">#}
            <div class="top_name top_name_v3" style="color: #A2ABED">新手任务</div>
            <div class="top_new new_bubble_desc"></div>
            {#            </div>#}
            <br/>
            <div class="top_bottom top_bottom_v3" hidden></div>
        </div>
    </div>
    <script>
        var width = document.body.offsetWidth;
        var bottom_v = (width / 375) * 16;
        var top_v = (width / 375) * 44;
        var padding_v = (width / 375) * 168;
        var margin_g = (width / 375) * 18;
        $(".pool_number").css("margin-bottom", bottom_v);
        $(".pool_number_v").css("margin-top", -top_v);
        $(".body_v").css("padding-top", padding_v);
        $(".top_task").css("margin", "0 " + margin_g + "px");
    </script>
</div>

<div class="task_body"></div>
<div class="no_task" hidden>
    <div>
        <img src="{{ request.MEDIA_CDN }}/static/img/task/game/no_task.png?v=1.0">
        <div>暂无任务</div>
    </div>
</div>

<div class="bottom_v">
    <div id="jiangli_jilu">
        <img src="{{ request.MEDIA_CDN }}/static/img/task/game/icon_guizhe.png?v=1.0">
        <span>奖励记录</span>
    </div>
    <div id="caichi_zonglan">
        <img src="{{ request.MEDIA_CDN }}/static/img/task/game/icon_liwu.png?v=1.0">
        <span>彩池总览</span>
    </div>

</div>

<!-- Modal 任务详情 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" style="background-color: rgba(0,0,0,0.2)"
     aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content myModal_content_1">
            <div class="modal_top">
                <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>-->
                <div class="modal_top_1">名称</div>
                <div class="modal_top_2">描叙</div>
            </div>
            <div class="modal_body">
                <div class="modal_body_g" id="modal_body_g">
                    <div class="modal_ modal_pzjd">
                        <span class="modal_schedule"></span>
                        <img class="modal_body_wancheng" style="width: 14px;display: none"
                             src="{{ request.MEDIA_CDN }}/static/img/task/fulfil.png?v=1.0">
                    </div>
                    <div class="modal_ modal_wanjia"></div>
                    <div class="modal_ renwu_jindu">
                        <div style="width: 82%">
                            <div class="div_progress_val">
                                <div class="div_progress_val_1">--</div>
                                <div class="div_progress_val_2">x次</div>
                            </div>
                        </div>
                        <div class="renwu_biaoti">进度</div>
                        <div class="sp_jindu">
                            <div class="sp_jindu_1"></div>
                            <div class="sp_jindu_2">
                                <div class="sp_jindu_2_1">
                                    <div class="sp_jindu_2_1_1"></div>
                                    <div class="sp_jindu_2_1_2">次数</div>
                                    <div>文字</div>
                                </div>
                            </div>
                            <div class="sp_jindu_3">
                                <img class="sp_jindu_2_img"
                                     src="{{ request.MEDIA_CDN }}/static/img/task/game/hongtao.png?v=1.0">
                            </div>
                        </div>
                    </div>
                    <div class="modal_ shoushu_biaoge">
                        <div class="btn_list">
                            <div class="btn_list_v1 btn_list_selected">排行榜</div>
                            <div class="btn_list_v2 btn_list_unselected">奖励表</div>
                        </div>
                        <div class="table">
                            <div class="table_1">
                                <div class="thead">
                                    <div class="thead_th">名次</div>
                                    <div class="thead_th">昵称</div>
                                    <div class="thead_th">积分</div>
                                    <div class="thead_th">奖励</div>
                                </div>
                                <div class="tbody" id="tbody_v1"></div>
                            </div>

                            <div class="table_2">
                                <div class="thead">
                                    <div class="thead_th">牌桌级别</div>
                                    <div class="thead_th">对应奖池</div>
                                    <div class="thead_th">每手=积分</div>
                                    <div class="thead_th">奖励名次</div>
                                    <div class="thead_th">最低积分</div>
                                </div>
                                <div class="tbody" id="tbody_v2"></div>
                            </div>

                        </div>
                    </div>
                    <div class="modal_ modal_hand_data">
                        <div class="modal_ front_progress_val"></div>
                        <div class="modal_ front_reward_desc" style="text-align: end;"></div>
                        <div class="modal_ low_progress_val"></div>
                        <div class="modal_ low_reward_desc" style="text-align: end;"></div>
                        <div class="modal_ modal_jifen_jiangli_v2"></div>
                        <div class="modal_ modal_jiangli_v2" style="text-align: end;"></div>
                    </div>
                    <div style="text-align: center;">
                        <div class="modal_ modal_jifen_jiangli"></div>
                        <div class="modal_ modal_jiangli"></div>
                        <div class="modal_ modal_btn"></div>
                        {#<div class="modal_ modal_zhouqi"></div>#}
                    </div>
                </div>
                <div style="text-align: center;">
                    <div class="modal_ modal_zhouqi"></div>
                    <div class="modal_ modal_end_time" id="modal_end_time"></div>
                    <div class="modal_ modal_end_time" id="modal_end_time_v2"></div>
                </div>
            </div>
        </div>
    </div>
</div>

{#领取成功#}
<div class="modal fade" id="myModal_jiangli" tabindex="-1" role="dialog" style="background-color: rgba(0,0,0,0.2)"
     aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div>
            <div class="stage">
                <img id="viewer" src="#" alt="">
                {#                <img id="" style="width: 100%" src="{{ request.MEDIA_CDN }}/static/img/task/cn.gif?v=1.0">#}
                <div class="jiangli_type">
                    <div class="stage_1">
                        <img id="reward_type_g" src="{{ request.MEDIA_CDN }}/static/img/task/receive_zuanshi.png?v=1.0">
                    </div>
                    <div class="stage_2">
                        <img src="{{ request.MEDIA_CDN }}/static/img/task/receive_biaoti.png?v=1.0">
                        <div id="reward_desc_g">钻石*100</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{#加载中，无蒙层#}
<div class="modal fade" id="myModal_loading" tabindex="-1" role="dialog" data-backdrop="false"
     aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document" style="width: 100%">
        <img id="viewer_loading" src="#" alt="" style="width: 50px">
    </div>
</div>

{#error，无蒙层#}
<div class="modal fade" id="myModal_error" tabindex="-1" role="dialog" data-backdrop="false"
     aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document" style="width: 100%">
        <div class="modal_dialog_error">错误提示</div>
    </div>
</div>


{#奖励记录#}
<div id="background" class="back">
    <div id="div1" class="content">
        <div class="jilu_modal">
            <div class="jilu_top">奖励记录</div>
            <div class="jilu_top_v2">
                <img src="{{ request.MEDIA_CDN }}/static/img/task/game/color_bar.png?v=1.0">
                <div>当日单次最大</div>
            </div>
            <div class="jilu_top_v3">
                <div class="jilu_nickname">某某某</div>
                <div class="jilu_blind_desc">1/2标准</div>
                <div class="jilu_award_amount">￥1888.88</div>
            </div>
            <div class="jilu_data">
                <div>
                    <div>排名</div>
                    <div>昵称</div>
                    <div>累计金额</div>
                </div>

                <div id="wrapper">
                    <ul id="wrapper_data">
                        <li>

                        </li>

                    </ul>
                </div>

            </div>
            <div class="jilu_bottom">展示当日获奖玩家排行</div>
        </div>
        <div id="close-button" data-dismiss="modal" aria-label="Close">
            <img style="width: 26px;" src="{{ request.MEDIA_CDN }}/static/img/task/game/close.png?v=1.0">
        </div>
    </div>
</div>
<div class="modal fade" id="myModal_jiangli_jilu" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     style="background-color: rgba(0,0,0,0.2)">
    <div class="modal-dialog" role="document">

    </div>

</div>

{#彩池总览#}
<div class="modal fade" id="myModal_caichi_zonglan" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     style="background-color: rgba(0,0,0,0.2)">
    <div class="modal-dialog" role="document">
        <div class="zonglan_dialog">
            <div class="zonglan_zongcaichi">总彩池</div>
            <div class="zonglan_zongcaichi_img">图片</div>
            <div class="zonglan_caichi">
                <div>
                    <div class="zonglan_xiaocaichi">小彩池</div>
                    <div class="zonglan_xiaocaichi_img">图片</div>
                </div>
                <div>
                    <div class="zonglan_zhongcaichi">中彩池</div>
                    <div class="zonglan_zhongcaichi_img">图片</div>
                </div>
                <div>
                    <div class="zonglan_dacaichi">大彩池</div>
                    <div class="zonglan_dacaichi_img">图片</div>
                </div>
            </div>
            <div class="zonglan_text">
                <div>
                    <div>
                        <img src="{{ request.MEDIA_CDN }}/static/img/task/game/juxing.png?v=1.0">
                        彩池说明
                    </div>
                    <div class="lottery_pool_explain"></div>
                </div>
                <div>
                    <div>
                        <img src="{{ request.MEDIA_CDN }}/static/img/task/game/juxing.png?v=1.0">
                        彩池任务说明
                    </div>
                    <div class="pool_task_explain"></div>
                </div>
                <div>
                    <div>
                        <img src="{{ request.MEDIA_CDN }}/static/img/task/game/juxing.png?v=1.0">
                        官方任务说明
                    </div>
                    <div class="official_task_explain"></div>
                </div>
                <div>
                    <div>
                        <img src="{{ request.MEDIA_CDN }}/static/img/task/game/juxing.png?v=1.0">
                        警告说明
                    </div>
                    <div class="task_warn_explain"></div>
                </div>
            </div>
        </div>
        <div data-dismiss="modal" aria-label="Close">
            <img style="width: 26px;" src="{{ request.MEDIA_CDN }}/static/img/task/game/close.png?v=1.0">
        </div>
    </div>
</div>

{#设置 data-backdrop="true"   单击背景时，弹窗关闭  #}
{#设置 data-backdrop="static" 单击背景时，弹窗 不 关闭  #}
{#设置 data-backdrop="false"  不存在背景，且单击背景时弹窗 不 关闭 #}

<input type="hidden" id="grand_list"/>
<input type="hidden" id="length_g"/>
<input type="hidden" id="tab_type"/>
<input type="hidden" id="game_from_index"/>
</body>
{# 'task_state': 0, # 任务状态 (0: 未开始 1: 完成中 2: 待领奖励 3: 已领取奖励)  #}
{# 奖励类型(1:竞技豆 2: 钻石 3: 彩池比例 4: 门票 5: 大盲)     #}
{# tab_type 0 彩池任务 3 官方任务 1 新手任务   #}

<script>
    //加载中
    {#window.addEventListener('load', function () {#}
    {#    // 设置图片的地址#}
    {#    var imgSrcs = [#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/1.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/2.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/3.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/4.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/5.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/6.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/7.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/8.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/9.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/10.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/11.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/12.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/13.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/14.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/15.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/16.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/17.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/18.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/19.png',#}
    {#        '{{ request.MEDIA_CDN }}/static/img/task/loading/20.png',#}
    {#    ];#}
    {#    // 设置滚动间隔时间(毫秒)#}
    {#    var interval = 100;#}
    {#    var viewer = document.getElementById('viewer_loading');#}
    {#    var current = 0;#}
    {#    var len = imgSrcs.length;#}
    {#    var setImage = function () {#}
    {##}
    {#        viewer.src = imgSrcs[current];#}
    {#        current = ++current > len - 1 ? 0 : current;#}
    {##}
    {#    };#}
    {#    setImage();#}
    {#    setInterval(setImage, interval);#}
    {# });#}
    var imgSrcs = [
        '{{ request.MEDIA_CDN }}/static/img/task/loading/1.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/2.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/3.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/4.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/5.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/6.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/7.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/8.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/9.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/10.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/11.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/12.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/13.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/14.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/15.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/16.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/17.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/18.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/19.png',
        '{{ request.MEDIA_CDN }}/static/img/task/loading/20.png',
    ]; // 图片地址
    var counter_g = 0;

    function cycle_g() {
        counter_g++;
        if (counter_g == imgSrcs.length) {
            //clearInterval(interval);
            counter_g = 0;
        }
        document.getElementById("viewer_loading").src = imgSrcs[counter_g];
    }

    var interval_g = ''

    // 打开弹窗事件
    $('#myModal_loading').on('show.bs.modal', function () {
        interval_g = setInterval(cycle_g, 100);  //interval是定义的全局，重复运行cycle函数，周期70ms
    });

    // 退出弹窗事件
    $('#myModal_loading').on('hide.bs.modal', function () {
        clearInterval(interval_g);    //结束重复运行
        counter_g = 0;    //图片恢复到第一张
    })
</script>
<script>
    var HtmlUtil = {
        /*1.用浏览器内部转换器实现html转码*/
        htmlEncode: function (html) {
            //1.首先动态创建一个容器标签元素，如DIV
            var temp = document.createElement("div");
            //2.然后将要转换的字符串设置为这个元素的innerText(ie支持)或者textContent(火狐，google支持)
            (temp.textContent != undefined) ? (temp.textContent = html) : (temp.innerText = html);
            //3.最后返回这个元素的innerHTML，即得到经过HTML编码转换的字符串了
            var output = temp.innerHTML;
            temp = null;
            return output;
        },
        /*2.用浏览器内部转换器实现html解码*/
        htmlDecode: function (text) {
            //1.首先动态创建一个容器标签元素，如DIV
            var temp = document.createElement("div");
            //2.然后将要转换的字符串设置为这个元素的innerHTML(ie，火狐，google都支持)
            temp.innerHTML = text;
            //3.最后返回这个元素的innerText(ie支持)或者textContent(火狐，google支持)，即得到经过HTML解码的字符串了。
            var output = temp.innerText || temp.textContent;
            temp = null;
            return output;
        }
    };

    var uid = "{{ request.GET.uid }}";
    var lang = "{{ request.GET.lang }}";
    var channel = "{{ request.GET.channel }}";
    var version = "{{ request.GET.version }}";
    var access_token = "{{ request.GET.access_token }}";

    //tab_type 0 彩池任务 3 官方任务 1 新手任务
    function task_master_list(tab_type, is_one) {
        $('#tab_type').val(tab_type);
        //加入定时器让它由快到慢滚动到顶部
        let timer = null;
        timer = setInterval(function () {
            //获取当前scrollTop的高度位置（兼容ie和chrom浏览器）
            var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            //开平方根，速度呈抛物线缓慢降低
            var ySpeed = Math.sqrt(scrollTop);
            document.documentElement.scrollTop = document.body.scrollTop = scrollTop - ySpeed;
            if (scrollTop == 0) {
                clearInterval(timer);
            }
        }, 5);
        //准备请求数据，默认第一次，客户端给了loading。。显示模态框
        //is_one赋值1，不加载动画
        if (is_one != 1) {
            $("#myModal_loading").modal();
        }
        $.ajax({
            type: 'POST',
            url: "{% url 'task_master_list' %}",
            data: {
                uid: uid,
                lang: lang,
                channel: channel,
                version: version,
                tab_type: tab_type,
            },
            dataType: 'JSON',
            success: function (response) {
                $("#myModal_loading").modal("hide");
                console.log(response)
                if (response.data.lottery_task_data.tab_bubble_desc) {
                    $(".lottery_bubble_desc").html(response.data.lottery_task_data.tab_bubble_desc).show();
                } else {
                    $(".lottery_bubble_desc").hide();
                }
                if (response.data.officialreal_task_data.tab_bubble_desc) {
                    $(".official_bubble_desc").html(response.data.officialreal_task_data.tab_bubble_desc).show();
                } else {
                    $(".official_bubble_desc").hide();
                }
                if (response.data.new_user_task_data.tab_bubble_desc) {
                    $(".new_bubble_desc").html(response.data.new_user_task_data.tab_bubble_desc).show();
                } else {
                    $(".new_bubble_desc").hide();
                }
                if (tab_type == 0) {
                    // 彩池
                    //$(".bottom_v").html("");
                    var data_task_list = response.data.lottery_task_data.task_list;
                    if (data_task_list.length != 0) {
                        $(".no_task").hide();
                        $(".task_body").empty().show();
                        for (var key in data_task_list) {
                            var master_max_award_list = data_task_list[key].master_max_award_list;
                            if (master_max_award_list.length == 0) {
                                var master_award = ''
                            } else {
                                var master_award = ''
                                for (var award_list in master_max_award_list) {
                                    if (master_max_award_list[award_list][0] == 2) {
                                        master_award += '<div>' +
                                            '<img class="task_img" src="{{ request.MEDIA_CDN }}/static/img/task/game/diamond.png?v=1.0">' +
                                            '<span style="color: #39A9FF">' + master_max_award_list[award_list][1] + '</span>' +
                                            '</div>'
                                    } else if (master_max_award_list[award_list][0] == 4) {
                                        master_award += '<div>' +
                                            '<img class="task_img" src="{{ request.MEDIA_CDN }}/static/img/task/game/coupon.png?v=1.0">' +
                                            '<span style="color: #A1FFDF">' + master_max_award_list[award_list][1] + '</span>' +
                                            '</div>'
                                    } else {
                                        master_award += '<div>' +
                                            '<img class="task_img" src="{{ request.MEDIA_CDN }}/static/img/task/game/cash.png?v=1.0">' +
                                            '<span style="color: #FFD302">' + master_max_award_list[award_list][1] + '</span>' +
                                            '</div>'
                                    }
                                }
                            }

                            if (data_task_list[key].task_rank_mode == 1) {
                                var icon_g = "icon_sp"
                            } else if (data_task_list[key].task_rank_mode == 5) {
                                var icon_g = "icon_cz"
                            } else {
                                var icon_g = "icon_ss"
                            }
                            if (data_task_list[key].tab_bubble_desc) {
                                var is_bubble = ''
                            } else {
                                var is_bubble = 'style="display: none"';
                            }
                            str = '<div class="task">' +
                                '   <div class="cheng_zhuo btn_master_toggle">' +
                                '     <div class="task_icon">' +
                                '         <img class="task_img_icon" src="{{ request.MEDIA_CDN }}/static/img/task/game/' + icon_g + '.png?v=1.0">' +
                                '     </div>' +
                                '     <div class="task_jieshao">' +
                                '        <div class="task_title">' + data_task_list[key].master_title +
                                '            <div id="bubble_desc_' + key + '" class="task_lingqu"' + is_bubble + '>' + data_task_list[key].tab_bubble_desc + '</div>' +
                                '        </div>' +
                                '         <div class="task_sub_title">' + data_task_list[key].master_sub_title + '</div>' +
                                '     </div>' +
                                '     <div class="task_reward">' + master_award + '</div>' +
                                '   </div>' +
                                '   <div class="chevron_down" id="chevron_down_' + key + '">' +
                                '       <div>' + data_task_list[key].master_bottom_desc + '</div>' +
                                '   </div>' +
                                '   <div class="task_min_div" style="display: none">' +
                                '       <hr class="hr_red"/>' +
                                '       <div class="task_child" id="task_child_' + key + '"> </div>' +
                                '       <div class="chevron_up">' +
                                '           <img src="{{ request.MEDIA_CDN }}/static/img/task/game/unfold.png?v=1.0">' +
                                '       </div>' +
                                '   </div>' +
                                '   <input type="hidden" class="task_rank_mode" value="' + data_task_list[key].task_rank_mode + '"/>' +
                                '   <input type="hidden" class="is_yesterday" value="' + data_task_list[key].is_yesterday + '"/>' +
                                '   <input type="hidden" class="length_g" value="' + key + '"/>' +
                                '</div>';
                            $(".task_body").append(str);
                        }
                        $(".task_body").append("<br/><br/><br/>");
                        // 进来默认打开第一个
                        //if (is_one == 1) {
                        $("#chevron_down_0").click();
                        //}
                    } else {
                        $(".no_task").show();
                        $(".task_body").hide();
                    }
                } else if (tab_type == 3) {
                    // 官方
                    //$(".bottom_v").html("");
                    var data_task_list = response.data.officialreal_task_data.task_list;
                    if (data_task_list.length != 0) {
                        $(".no_task").hide();
                        $(".task_body").empty().show();
                        for (var key in data_task_list) {

                            if (data_task_list[key].tab_bubble_desc) {
                                var is_bubble = ''
                            } else {
                                var is_bubble = 'style="display: none"';
                            }

                            var width_g = (100 / data_task_list[key].condition_value) * data_task_list[key].progress_val;

                            if (data_task_list[key].task_state == 2) {
                                var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">领取</div>'
                            } else if (data_task_list[key].task_state == 3) {
                                var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">已完成</div>'
                            } else {
                                btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_transparent.png?v=1.0"><div style="color:#FFCC00">查看</div>'
                            }

                            if (data_task_list[key].reward_type == 2) {
                                var is_reward = '当前'
                                var time_g = '活动时间：' + data_task_list[key].start_date + '-' + data_task_list[key].end_date + '，领取当日返利后列表刷新'
                            } else {
                                var is_reward = '';
                                var time_g = '活动时间：' + data_task_list[key].start_date + '-' + data_task_list[key].end_date + '，满' + data_task_list[key].act_date + '日可领取所有返利'
                            }

                            if (data_task_list[key].task_game_type == 1) {
                                var task_game_type_img = "official_cowboy"
                            } else if (data_task_list[key].task_game_type == 2) {
                                var task_game_type_img = "official_luck_point"
                            } else {
                                var task_game_type_img = "official_table"
                            }

                            str = '<div class="task myModal_official">\n' +
                                '    <div class="cheng_zhuo" style="padding: 17px 15px 0 8px;">\n' +
                                '        <div class="task_icon" style="padding-top: 13px;">\n' +
                                '             <img class="task_img_icon" src="{{ request.MEDIA_CDN }}/static/img/task/game/' + task_game_type_img + '.png?v=1.0">' +
                                '        </div>\n' +
                                '        <div class="task_jieshao">\n' +
                                '            <div class="task_title">' + data_task_list[key].task_name + '</div>\n' +
                                '            <div class="task_lingqu" ' + is_bubble + '>' + data_task_list[key].tab_bubble_desc + '</div>\n' +
                                '            <div class="task_sub_title">活动倒计时：' + data_task_list[key].residue_days + '天</div>\n' +
                                '            <div class="task_sub_title">' + is_reward + '累计返利：<span style="color: #F06464">￥' + data_task_list[key].award_num + '</span></div>\n' +
                                '        </div>\n' +
                                '        <div style="flex: 1;display: flex;align-items: center;justify-content: flex-end;">' +
                                '            <div class="task_child_btn btn_' + data_task_list[key].unique_id + '" style="float: none;margin-top: 0"> ' + btn_g + '</div>' +
                                '            <input type="hidden" class="task_list" value=\'' + JSON.stringify(data_task_list[key]) + '\'/>' +
                                '            <input type="hidden" class="tab_type" value="3"/>' +
                                '        </div>' +
                                '    </div>\n' +
                                '    <hr style="width: 90%"/>\n' +
                                '    <div style="padding: 0 0 7px 0;color: #999999;font-size: 10px;">' + time_g + '</div>\n' +
                                ' </div>';

                            $(".task_body").append(str);
                        }
                        $(".task_body").append("<br/><br/><br/>");
                    } else {
                        $(".no_task").show();
                        $(".task_body").hide();
                    }
                } else if (tab_type == 1) {
                    // 新手
                    //$(".bottom_v").html("新手任务周期30天，请达成后尽快领取奖励，任务到期失效！");
                    var data_task_list = response.data.new_user_task_data.task_list;
                    if (data_task_list.length != 0) {
                        $(".no_task").hide();
                        $(".task_body").empty().show();
                        for (var key in data_task_list) {

                            if (data_task_list[key].tab_bubble_desc) {
                                var is_bubble = ''
                            } else {
                                var is_bubble = 'style="display: none"';
                            }
                            if (data_task_list[key].is_no_lock == 0) {
                                str = '<div class="task myModal_new_user_is_no">' +
                                    '                    <div class="cheng_zhuo" style="padding: 17px 15px 15px 8px;">' +
                                    '                        <div class="task_icon" style="padding-top: 13px;">' +
                                    '                            <img class="task_img_icon"' +
                                    '                                 src="{{ request.MEDIA_CDN }}/static/img/task/game/new_icon_suo.png?v=1.0">' +
                                    '                        </div>' +
                                    '                        <div class="task_jieshao">' +
                                    '                            <div class="task_title">任务待解锁</div>' +
                                    '                                <div class="task_lingqu"' + is_bubble + '>' + data_task_list[key].tab_bubble_desc + '</div>' +
                                    '                            <div class="task_sub_title" style="color:#BBE0FF">--</div>' +
                                    '                            <div class="task_jindu" style="color:#FFCC00">--</div>' +
                                    '                        </div>' +
                                    '                        <div style="flex: 1;display: flex;align-items: center;justify-content: flex-end;">' +
                                    '                            <div class="task_child_btn btn_' + data_task_list[key].unique_id + '"' +
                                    '                                 style="float: none;margin-top: 0">' +
                                    '                                <img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0">' +
                                    '                                <div>待解锁</div>' +
                                    '                            </div>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                </div>';
                            } else {
                                if (data_task_list[key].condition_value > 1) {
                                    var condition_value = 'new_icon_new'
                                } else {
                                    var condition_value = 'new_icon_shengya';
                                }

                                var width_g = (100 / data_task_list[key].condition_value) * data_task_list[key].progress_val;

                                if (data_task_list[key].task_state == 2) {
                                    var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">领取</div>'
                                } else if (data_task_list[key].task_state == 3) {
                                    var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">已完成</div>'
                                } else {
                                    btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_transparent.png?v=1.0"><div style="color:#FFCC00">查看</div>'
                                }

                                str = '<div class="task myModal_new_user">' +
                                    '                    <div class="cheng_zhuo" style="padding: 17px 15px 15px 8px;">' +
                                    '                        <div class="task_icon" style="padding-top: 13px;">' +
                                    '                           <img class="task_img_icon" src="{{ request.MEDIA_CDN }}/static/img/task/game/' + condition_value + '.png?v=1.0">' +
                                    '                        </div>' +
                                    '                        <div class="task_jieshao">' +
                                    '                            <div class="task_title">' + data_task_list[key].task_name + '</div>' +
                                    '                            <div class="task_lingqu"' + is_bubble + '>' + data_task_list[key].tab_bubble_desc + '</div>' +
                                    '                            <div class="task_sub_title">' + data_task_list[key].task_title + '</div>' +
                                    '                            <div class="task_jindu">' +
                                    '                                <span>进度</span>' +
                                    '                                <div class="jindutiao">' +
                                    '                                    <div class="jindutiao_1" style="width:' + width_g + '%"></div>' +
                                    '                                </div>' +
                                    '                                <span>' + data_task_list[key].progress_val + '/' + data_task_list[key].condition_value + '</span>' +
                                    '                                &nbsp;&nbsp;' +
                                    '                                <span style="color: #FFCC00">奖励:' + data_task_list[key].reward_desc + '&nbsp;&nbsp;' + data_task_list[key].reward_desc_2 + '</span>' +
                                    '                            </div>' +
                                    '                        </div>' +
                                    '                        <div style="flex: 1;display: flex;align-items: center;justify-content: flex-end;">' +
                                    '                            <div class="task_child_btn btn_' + data_task_list[key].unique_id + '" style="float: none;margin-top: 0"> ' + btn_g + '</div>' +
                                    '                            <input type="hidden" class="task_list" value=\'' + JSON.stringify(data_task_list[key]) + '\'/>' +
                                    '                            <input type="hidden" class="tab_type" value="1"/>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                </div>';

                            }

                            $(".task_body").append(str);
                        }
                        $(".task_body").append("<br/><br/><br/>");
                    } else {
                        $(".no_task").show();
                        $(".task_body").hide();
                    }
                } else {
                    $(".no_task").show();
                    $(".task_body").hide();
                }

            }
        });
    }

    // 点击彩池任务，tab_type = 0
    $(".top_task_v1").click(function () {
        $(".top_name").css("color", "#A2ABED");
        $(".top_bottom").hide();
        $(".top_name_v1").css("color", "#FFFFFF");
        $(".top_bottom_v1").show();
        task_master_list(0);
    });
    // 点击官方任务，tab_type = 3
    $(".top_task_v2").click(function () {
        $(".top_name").css("color", "#A2ABED");
        $(".top_bottom").hide();
        $(".top_name_v2").css("color", "#FFFFFF");
        $(".top_bottom_v2").show();
        task_master_list(3);
    });
    // 点击新手任务，tab_type = 1
    $(".top_task_v3").click(function () {
        $(".top_name").css("color", "#A2ABED");
        $(".top_bottom").hide();
        $(".top_name_v3").css("color", "#FFFFFF");
        $(".top_bottom_v3").show();
        task_master_list(1);
    });

    // 进来默认请求数据
    if ('{{ request.GET.tab_type }}' == 1) {
        $(".top_name").css("color", "A2ABED");
        $(".top_bottom").hide();
        $(".top_name_v3").css("color", "#FFFFFF");
        $(".top_bottom_v3").show();
        task_master_list(1, 1);
    } else if ('{{ request.GET.tab_type }}' == 3) {
        $(".top_name").css("color", "A2ABED");
        $(".top_bottom").hide();
        $(".top_name_v2").css("color", "#FFFFFF");
        $(".top_bottom_v2").show();
        task_master_list(3, 1);
    } else {
        $(".top_name").css("color", "A2ABED");
        $(".top_bottom").hide();
        $(".top_name_v1").css("color", "#FFFFFF");
        $(".top_bottom_v1").show();
        task_master_list(0, 1);
    }

    // nice，展开收起
    $(document).ready(function () {
        // 展开
        $(".task_body").on("click", '.chevron_down', function () {
            $(this).next().toggle();
            //$(this).hide();
            is_request = '1'
        });
        // 收起
        $(".task_body").on("click", '.chevron_up', function () {
            $(this).parent().toggle();
            //$(this).parent().prev().toggle();
        });
        // 点击主列表，可展开可收起
        $(".task_body").on("click", '.btn_master_toggle', function () {
            //$(this).next().toggle();
            $(this).next().next().toggle();
            //这里判断点击后变成什么了，因为上一句已经执行了toggle操作
            if ($(this).next().next().is(":hidden")) {
                is_request = '0'
            } else {
                is_request = '1'
            }

        });

        $(function () {
            $('.task_body').on('click', '.chevron_down', fn);
            $('.task_body').on('click', '.btn_master_toggle', fn);
        });
        var fn = function () {

            if (is_request == 1) {
                $("#myModal_loading").modal();
            } else {
                return false
            }
            var task_rank_mode = $(this).parent().find(".task_rank_mode").val();
            var length_g = $(this).parent().find(".length_g").val();
            var is_yesterday = "";
            if (task_rank_mode == 6) {
                is_yesterday = $(this).parent().find(".is_yesterday").val();
            }

            $.ajax({
                type: 'POST',
                url: "{% url 'lottery_task_sub_list' %}",
                data: {
                    uid: uid,
                    lang: lang,
                    channel: channel,
                    version: version,
                    task_rank_mode: task_rank_mode,
                    is_yesterday: is_yesterday,
                },
                success: function (response) {
                    $("#myModal_loading").modal("hide");
                    console.log(response)
                    var data_task_list = response.data.task_list;
                    $("#task_child_" + length_g).empty();
                    if (task_rank_mode == 5) {
                        // 撑桌任务
                        for (var key in data_task_list) {

                            var width_g = (100 / data_task_list[key].chenzhuo_award_hand_num) * data_task_list[key].progress_val;

                            if (data_task_list[key].task_state == 2) {
                                var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">领取</div>'
                            } else if (data_task_list[key].task_state == 3) {
                                var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">已完成</div>'
                            } else {
                                btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_transparent.png?v=1.0"><div style="color:#FFCC00">查看</div>'
                            }

                            str = '<div class="myModal_cheng_zhuo">\n' +
                                '     <div>\n' +
                                '          <div class="task_name">' + data_task_list[key].task_name + '</div>\n' +
                                '          <div class="task_jindu">\n' +
                                '              <span>进度</span>\n' +
                                '              <div class="jindutiao">\n' +
                                '                  <div class="jindutiao_1" style="width:' + width_g + '%"></div>\n' +
                                '              </div>\n' +
                                '              <span>' + data_task_list[key].progress_val + '/' + data_task_list[key].chenzhuo_award_hand_num + '</span>' +
                                '              &nbsp;&nbsp;\n' +
                                '              <span style="color: #FFCC00">奖励:' + data_task_list[key].reward_desc + '</span>\n' +
                                '          </div>\n' +
                                '      </div>\n' +
                                '      <div class="task_child_btn btn_' + data_task_list[key].unique_id + '">' + btn_g + '</div>\n' +
                                '      <hr/>\n' +
                                '      <input type="hidden" class="task_list" value=\'' + JSON.stringify(data_task_list[key]) + '\'/>' +
                                '      <input type="hidden" class="tab_type" value="0"/>' +
                                '      <input type="hidden" class="length_g2" value=\'' + length_g + '\'/>' +
                                '  </div>';

                            $("#task_child_" + length_g).append(str);
                        }
                    } else if (task_rank_mode == 6) {
                        // 手数积分排行
                        for (var key in data_task_list) {

                            if (data_task_list[key].task_state == 2) {
                                var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">领取</div>'
                            } else if (data_task_list[key].task_state == 3) {
                                var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">已完成</div>'
                            } else {
                                btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_transparent.png?v=1.0"><div style="color:#FFCC00">查看</div>'
                            }

                            str = '<div class="myModal_hand_point">\n' +
                                '   <div>\n' +
                                '       <div class="task_name">' + data_task_list[key].task_name + '</div>\n' +
                                '       <div class="task_jindu">\n' +
                                '           <span>' + data_task_list[key].exit_time_caption + '：' + data_task_list[key].task_exit + '</span>\n' +
                                '           &nbsp;&nbsp;\n' +
                                '           <span>' + data_task_list[key].reward_id_caption + '：' + data_task_list[key].reward_id + '</span>\n' +
                                '       </div>\n' +
                                '       <div class="task_jindu">\n' +
                                '           <span><!-- 当前积分 -->' + data_task_list[key].progress_val_caption + '：' + data_task_list[key].progress_val + '</span>\n' +
                                '           &nbsp;&nbsp;\n' +
                                '           <span>' + data_task_list[key].reward_caption + ':</span>\n' +
                                '           <span style="color: #FF3F40">' + data_task_list[key].reward_desc + '</span>\n' +
                                '       </div>\n' +
                                '   </div>\n' +
                                '   <div class="task_child_btn btn_' + data_task_list[key].unique_id + '">' + btn_g + '</div>\n' +
                                '   <hr/>\n' +
                                '   <input type="hidden" class="task_list" value=\'' + JSON.stringify(data_task_list[key]) + '\'/>' +
                                '   <input type="hidden" class="tab_type" value="0"/>' +
                                '   <input type="hidden" class="length_g2" value=\'' + length_g + '\'/>' +
                                '</div>'

                            $("#task_child_" + length_g).append(str);
                        }
                    } else {
                        // 幸运手牌
                        for (var key in data_task_list) {

                            var width_g = (100 / data_task_list[key].condition_value) * data_task_list[key].progress_val;

                            if (data_task_list[key].task_state == 2) {
                                var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">领取</div>'
                            } else if (data_task_list[key].task_state == 3) {
                                var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">已完成</div>'
                            } else {
                                btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_transparent.png?v=1.0"><div style="color:#FFCC00">查看</div>'
                            }

                            str = '<div class="myModal_lucky_poker">\n' +
                                '     <div>\n' +
                                '          <div class="task_name">' + data_task_list[key].task_name +
                                '              <img class="img_card" src="{{ request.MEDIA_CDN }}/static/img/task/poker/' + data_task_list[key].card_1 + '.png?v=1.0">' +
                                '              <img class="img_card" src="{{ request.MEDIA_CDN }}/static/img/task/poker/' + data_task_list[key].card_2 + '.png?v=1.0">' +
                                '          </div>\n' +
                                '          <div class="task_jindu">\n' +
                                '              <span>进度</span>\n' +
                                '              <div class="jindutiao">\n' +
                                '                  <div class="jindutiao_1" style="width:' + width_g + '%"></div>\n' +
                                '              </div>\n' +
                                '              <span>' + data_task_list[key].progress_val + '/' + data_task_list[key].condition_value + '</span>' +
                                '              &nbsp;&nbsp;\n' +
                                '              <span style="color: #FFCC00">奖励:' + data_task_list[key].reward_desc + '</span>\n' +
                                '          </div>\n' +
                                '      </div>\n' +
                                '      <div class="task_child_btn btn_' + data_task_list[key].unique_id + '">' + btn_g + '</div>\n' +
                                '      <hr/>\n' +
                                '      <input type="hidden" class="task_list" value=\'' + JSON.stringify(data_task_list[key]) + '\'/>' +
                                '      <input type="hidden" class="tab_type" value="0"/>' +
                                '      <input type="hidden" class="length_g2" value=\'' + length_g + '\'/>' +
                                '  </div>';

                            $("#task_child_" + length_g).append(str);
                        }
                    }

                }
            });

        }

    });

    // 跳转到应用，领取按钮   新版
    $(".task_body").on("click", '.task_child_btn', function () {
        var task_list = $(this).parent().find(".task_list").val();
        var tab_type = $(this).parent().find(".tab_type").val();
        var length_g = $(this).parent().find(".length_g2").val();
        var data = eval('(' + HtmlUtil.htmlDecode(task_list).replace(/u'/g, "'") + ')');

        click_btn_Share(tab_type, length_g, data);

        if (data.task_state == 0 || data.task_state == 1) {

        } else {
            // 加上这句就不会弹窗了
            return false
        }

    });

    // 跳转到应用，领取按钮，旧版，弹窗内
    function jumpClick(tab_type) {
        var grand_list = $("#grand_list").val();
        var length_g = $("#length_g").val();
        var data = eval('(' + HtmlUtil.htmlDecode(grand_list).replace(/u'/g, "'") + ')');

        click_btn_Share(tab_type, length_g, data);
        // 关闭弹窗
        $("#myModal").modal("hide");
    }

    // 按钮的操作逻辑
    function click_btn_Share(tab_type, length_g, data) {
        console.log(data);
        if (tab_type == 3) {
            var award_num = "";
            var reward_desc_g = "现金*" + data.award_num;
        } else {
            var award_num = data.award_num;
            var reward_desc_g = data.reward_desc;
        }
        $("#reward_desc_g").html(reward_desc_g);
        if (data.reward_type == 2) {
            $("#reward_type_g").attr("src", "{{ request.MEDIA_CDN }}/static/img/task/receive_zuanshi.png");
        } else if (data.reward_type == 4) {
            $("#reward_type_g").attr("src", "{{ request.MEDIA_CDN }}/static/img/task/receive_menpiao.png");
        } else {
            $("#reward_type_g").attr("src", "{{ request.MEDIA_CDN }}/static/img/task/receive_xianjin.png");
        }
        var task_rank_mode = data.task_rank_mode;
        if (data.task_state == 0 || data.task_state == 1) {

        } else if (data.task_state == 2) {
            $.ajax({
                type: 'POST',
                url: "{% url 'task_receive_award' %}",
                data: {
                    uid: uid,
                    lang: lang,
                    channel: channel,
                    version: version,
                    access_token: access_token,

                    tab_type: tab_type,
                    award_num: award_num,
                    config_id: data.config_id,
                    task_rank_mode: data.task_rank_mode,
                    is_yesterday: data.is_yesterday,
                },
                success: function (result) {
                    console.log(result)
                    if (result.code == 0) {
                        // 成功动画
                        $("#myModal_jiangli").modal();
                        setTimeout(function () {
                            $("#myModal_jiangli").modal("hide");
                        }, 2000);
                        // 重新渲染数据
                        if (tab_type == 0) {
                            var data_task_list = result.task_data.task_list;
                            // 主tab气泡
                            if (result.lottery_tab_bubble_desc) {
                                $(".lottery_bubble_desc").html(result.lottery_tab_bubble_desc).show();
                            } else {
                                $(".lottery_bubble_desc").hide();
                            }
                            // 模式任务气泡
                            if (result.task_data.tab_bubble_desc) {
                                $("#bubble_desc_" + length_g).html(result.task_data.tab_bubble_desc).show();
                            } else {
                                $("#bubble_desc_" + length_g).hide();
                            }
                            $("#task_child_" + length_g).empty();
                            if (task_rank_mode == 5) {
                                // 撑桌任务
                                for (var key in data_task_list) {

                                    var width_g = (100 / data_task_list[key].chenzhuo_award_hand_num) * data_task_list[key].progress_val;

                                    if (data_task_list[key].task_state == 2) {
                                        var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">领取</div>'
                                    } else if (data_task_list[key].task_state == 3) {
                                        var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">已完成</div>'
                                    } else {
                                        btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_transparent.png?v=1.0"><div style="color:#FFCC00">查看</div>'
                                    }

                                    str = '<div class="myModal_cheng_zhuo">\n' +
                                        '     <div>\n' +
                                        '          <div class="task_name">' + data_task_list[key].task_name + '</div>\n' +
                                        '          <div class="task_jindu">\n' +
                                        '              <span>进度</span>\n' +
                                        '              <div class="jindutiao">\n' +
                                        '                  <div class="jindutiao_1" style="width:' + width_g + '%"></div>\n' +
                                        '              </div>\n' +
                                        '              <span>' + data_task_list[key].progress_val + '/' + data_task_list[key].chenzhuo_award_hand_num + '</span>' +
                                        '              &nbsp;&nbsp;\n' +
                                        '              <span style="color: #FFCC00">奖励:' + data_task_list[key].reward_desc + '</span>\n' +
                                        '          </div>\n' +
                                        '      </div>\n' +
                                        '      <div class="task_child_btn btn_' + data_task_list[key].unique_id + '">' + btn_g + '</div>\n' +
                                        '      <hr/>\n' +
                                        '      <input type="hidden" class="task_list" value=\'' + JSON.stringify(data_task_list[key]) + '\'/>' +
                                        '      <input type="hidden" class="tab_type" value="0"/>' +
                                        '      <input type="hidden" class="length_g2" value=\'' + length_g + '\'/>' +
                                        '  </div>';

                                    $("#task_child_" + length_g).append(str);
                                }
                            } else if (task_rank_mode == 6) {
                                // 手数积分排行
                                for (var key in data_task_list) {

                                    if (data_task_list[key].task_state == 2) {
                                        var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">领取</div>'
                                    } else if (data_task_list[key].task_state == 3) {
                                        var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">已完成</div>'
                                    } else {
                                        btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_transparent.png?v=1.0"><div style="color:#FFCC00">查看</div>'
                                    }

                                    str = '<div class="myModal_hand_point">\n' +
                                        '   <div>\n' +
                                        '       <div class="task_name">' + data_task_list[key].task_name + '</div>\n' +
                                        '       <div class="task_jindu">\n' +
                                        '           <span>' + data_task_list[key].exit_time_caption + '：' + data_task_list[key].task_exit + '</span>\n' +
                                        '           &nbsp;&nbsp;\n' +
                                        '           <span>' + data_task_list[key].reward_id_caption + '：' + data_task_list[key].reward_id + '</span>\n' +
                                        '       </div>\n' +
                                        '       <div class="task_jindu">\n' +
                                        '           <span><!-- 当前积分 -->' + data_task_list[key].progress_val_caption + '：' + data_task_list[key].progress_val + '</span>\n' +
                                        '           &nbsp;&nbsp;\n' +
                                        '           <span>' + data_task_list[key].reward_caption + ':</span>\n' +
                                        '           <span style="color: #FF3F40">' + data_task_list[key].reward_desc + '</span>\n' +
                                        '       </div>\n' +
                                        '   </div>\n' +
                                        '   <div class="task_child_btn btn_' + data_task_list[key].unique_id + '">' + btn_g + '</div>\n' +
                                        '   <hr/>\n' +
                                        '   <input type="hidden" class="task_list" value=\'' + JSON.stringify(data_task_list[key]) + '\'/>' +
                                        '   <input type="hidden" class="tab_type" value="0"/>' +
                                        '   <input type="hidden" class="length_g2" value=\'' + length_g + '\'/>' +
                                        '</div>'

                                    $("#task_child_" + length_g).append(str);
                                }
                            } else {
                                // 幸运手牌
                                for (var key in data_task_list) {

                                    var width_g = (100 / data_task_list[key].condition_value) * data_task_list[key].progress_val;

                                    if (data_task_list[key].task_state == 2) {
                                        var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">领取</div>'
                                    } else if (data_task_list[key].task_state == 3) {
                                        var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">已完成</div>'
                                    } else {
                                        btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_transparent.png?v=1.0"><div style="color:#FFCC00">查看</div>'
                                    }

                                    str = '<div class="myModal_lucky_poker">\n' +
                                        '     <div>\n' +
                                        '          <div class="task_name">' + data_task_list[key].task_name +
                                        '              <img class="img_card" src="{{ request.MEDIA_CDN }}/static/img/task/poker/' + data_task_list[key].card_1 + '.png?v=1.0">' +
                                        '              <img class="img_card" src="{{ request.MEDIA_CDN }}/static/img/task/poker/' + data_task_list[key].card_2 + '.png?v=1.0">' +
                                        '          </div>\n' +
                                        '          <div class="task_jindu">\n' +
                                        '              <span>进度</span>\n' +
                                        '              <div class="jindutiao">\n' +
                                        '                  <div class="jindutiao_1" style="width:' + width_g + '%"></div>\n' +
                                        '              </div>\n' +
                                        '              <span>' + data_task_list[key].progress_val + '/' + data_task_list[key].condition_value + '</span>' +
                                        '              &nbsp;&nbsp;\n' +
                                        '              <span style="color: #FFCC00">奖励:' + data_task_list[key].reward_desc + '</span>\n' +
                                        '          </div>\n' +
                                        '      </div>\n' +
                                        '      <div class="task_child_btn btn_' + data_task_list[key].unique_id + '">' + btn_g + '</div>\n' +
                                        '      <hr/>\n' +
                                        '      <input type="hidden" class="task_list" value=\'' + JSON.stringify(data_task_list[key]) + '\'/>' +
                                        '      <input type="hidden" class="tab_type" value="0"/>' +
                                        '      <input type="hidden" class="length_g2" value=\'' + length_g + '\'/>' +
                                        '  </div>';

                                    $("#task_child_" + length_g).append(str);
                                }
                            }
                        } else {
                            setTimeout(function () {
                                task_master_list(tab_type);
                            }, 2000);

                        }
                    } else {
                        // 错误动画
                        $(".modal_dialog_error").html(result.error);
                        $("#myModal_error").modal();
                        setTimeout(function () {
                            $("#myModal_error").modal("hide");
                        }, 2000);
                    }
                }
            });
        } else if (data.task_state == 3) {
            // 幸运手牌才有
            if (task_rank_mode == 1) {
                $.ajax({
                    type: 'POST',
                    url: "{% url 'task_receive_award' %}",
                    data: {
                        uid: uid,
                        lang: lang,
                        channel: channel,
                        version: version,
                        access_token: access_token,

                        tab_type: tab_type,
                        award_num: award_num,
                        config_id: data.config_id,
                        task_rank_mode: data.task_rank_mode,
                        is_yesterday: data.is_yesterday,
                    },
                    success: function (result) {
                        console.log(result)
                        if (result.code == 0) {
                            // 重新渲染数据
                            var data_task_list = result.task_data.task_list;
                            // 主tab气泡
                            if (result.lottery_tab_bubble_desc) {
                                $(".lottery_bubble_desc").html(result.lottery_tab_bubble_desc).show();
                            } else {
                                $(".lottery_bubble_desc").hide();
                            }
                            // 模式任务气泡
                            if (result.task_data.tab_bubble_desc) {
                                $("#bubble_desc_" + length_g).html(result.task_data.tab_bubble_desc).show();
                            } else {
                                $("#bubble_desc_" + length_g).hide();
                            }
                            $("#task_child_" + length_g).empty();

                            for (var key in data_task_list) {

                                var width_g = (100 / data_task_list[key].condition_value) * data_task_list[key].progress_val;

                                if (data_task_list[key].task_state == 2) {
                                    var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">领取</div>'
                                } else if (data_task_list[key].task_state == 3) {
                                    var btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">已完成</div>'
                                } else {
                                    btn_g = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_transparent.png?v=1.0"><div style="color:#FFCC00">查看</div>'
                                }

                                str = '<div class="myModal_lucky_poker">\n' +
                                    '     <div>\n' +
                                    '          <div class="task_name">' + data_task_list[key].task_name +
                                    '              <img class="img_card" src="{{ request.MEDIA_CDN }}/static/img/task/poker/' + data_task_list[key].card_1 + '.png?v=1.0">' +
                                    '              <img class="img_card" src="{{ request.MEDIA_CDN }}/static/img/task/poker/' + data_task_list[key].card_2 + '.png?v=1.0">' +
                                    '          </div>\n' +
                                    '          <div class="task_jindu">\n' +
                                    '              <span>进度</span>\n' +
                                    '              <div class="jindutiao">\n' +
                                    '                  <div class="jindutiao_1" style="width:' + width_g + '%"></div>\n' +
                                    '              </div>\n' +
                                    '              <span>' + data_task_list[key].progress_val + '/' + data_task_list[key].condition_value + '</span>' +
                                    '              &nbsp;&nbsp;\n' +
                                    '              <span style="color: #FFCC00">奖励:' + data_task_list[key].reward_desc + '</span>\n' +
                                    '          </div>\n' +
                                    '      </div>\n' +
                                    '      <div class="task_child_btn btn_' + data_task_list[key].unique_id + '">' + btn_g + '</div>\n' +
                                    '      <hr/>\n' +
                                    '      <input type="hidden" class="task_list" value=\'' + JSON.stringify(data_task_list[key]) + '\'/>' +
                                    '      <input type="hidden" class="tab_type" value="0"/>' +
                                    '      <input type="hidden" class="length_g2" value=\'' + length_g + '\'/>' +
                                    '  </div>';

                                $("#task_child_" + length_g).append(str);
                            }

                        } else {
                            // 错误动画
                            $(".modal_dialog_error").html(result.error);
                            $("#myModal_error").modal();
                            setTimeout(function () {
                                $("#myModal_error").modal("hide");
                            }, 2000);
                        }
                    }
                });
            }
        }

    }

    // 领取成功事件一套，start
    var banners = [
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/1.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/2.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/3.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/4.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/5.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/6.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/7.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/8.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/9.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/10.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/11.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/12.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/13.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/14.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/15.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/16.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/17.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/18.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/19.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/20.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/21.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/22.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/23.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/24.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/26.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/27.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/28.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/29.png',
        '{{ request.MEDIA_CDN }}/static/img/task/receive_zh/30.png',
    ]; // 图片地址
    var counter = 0;

    function cycle() {
        counter++;
        if (counter == banners.length) {
            clearInterval(interval);    // 加这句的意思是，只轮播一轮。就停，性能提升
            counter = 0;
        }
        document.getElementById("viewer").src = banners[counter];
    }

    // 打开弹窗事件
    $('#myModal_jiangli').on('show.bs.modal', function () {
        interval = setInterval(cycle, 70);  //interval是定义的全局，重复运行cycle函数，周期70ms
    });

    // 退出弹窗事件
    $('#myModal_jiangli').on('hide.bs.modal', function () {
        clearInterval(interval);    //结束重复运行
        counter = 0;    //图片恢复到第一张
    })
    // 领取成功事件一套，end

    // 点击错误提示，使其消失
    $("#myModal_error").click(function () {
        $("#myModal_error").modal("hide");
    });

    // 手数排行 切换列表按钮1
    $(".btn_list_v1").click(function () {
        $(".btn_list_v1").attr("class", "btn_list_v1 btn_list_selected");
        $(".btn_list_v2").attr("class", "btn_list_v2 btn_list_unselected");
        $(".table_1").show();
        $(".table_2").hide();
    });
    // 手数排行 切换列表按钮2
    $(".btn_list_v2").click(function () {
        $(".btn_list_v1").attr("class", "btn_list_v1 btn_list_unselected");
        $(".btn_list_v2").attr("class", "btn_list_v2 btn_list_selected");
        $(".table_1").hide();
        $(".table_2").show();
    });

    // 官方1，新手2任务的弹窗
    // 这里有一个细节，彩池返回用的是task_dict，官方、新手用的是task_data
    // 撑桌任务弹窗
    $(".task_body").on("click", '.myModal_cheng_zhuo', function () {

        $("#modal_body_g").attr("class", "modal_body_g")

        var task_list = $(this).find(".task_list").val();
        var data = eval('(' + HtmlUtil.htmlDecode(task_list).replace(/u'/g, "'") + ')');
        $("#length_g").val($(this).find(".length_g2").val());
        console.log(data)
        $("#myModal").modal();
        $.ajax({
            type: 'POST',
            url: "{% url 'cheng_zhuo_task_detail' %}",
            data: {
                uid: uid,
                lang: lang,
                channel: channel,
                version: version,
                access_token: access_token,
                poker_id: data.poker_id,
            },
            success: function (result) {
                if (result.ret == 0) {

                    $(".modal_").hide();
                    $(".modal_pzjd").show();
                    $(".modal_wanjia").show();
                    $(".modal_jiangli").show();

                    $(".modal_top_1").html(result.task_dict.task_name);
                    $(".modal_top_2").html(result.task_dict.task_detail_desc);
                    $(".modal_schedule").html("牌桌进度：" + result.task_dict.desk_progress_val + " / " + result.task_dict.mz_award_hand_num);
                    $(".modal_zhouqi").html(result.task_dict.bottom_desc).show();
                    if (result.task_dict.is_manzu) {
                        $(".modal_body_wancheng").show();
                    } else {
                        $(".modal_body_wancheng").hide();
                    }
                    if (result.task_dict.task_state == 2) {
                        $(".modal_jiangli").html("奖励：" + result.task_dict.reward_desc);
                        $(".modal_btn").html('<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">领取</div>');
                    } else if (result.task_dict.task_state == 3) {
                        $(".modal_jiangli").html("奖励：" + result.task_dict.reward_desc);
                        $(".modal_btn").html('<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">已完成</div>');
                    } else {
                        $(".modal_jiangli").html("达成可领取：" + result.task_dict.reward_desc);
                        $(".modal_btn").html('');
                    }
                    $("#grand_list").val(JSON.stringify(result.task_dict));
                    $(".modal_btn").attr("onclick", 'jumpClick(0)').show();
                    $(".modal_btn").attr("class", 'modal_btn btn_' + result.task_dict.unique_id);

                    var grand = 100 / result.task_dict.chenzhuo_award_hand_num;
                    $(".modal_wanjia").empty();
                    for (var i in result.user_hand_list) {
                        str = '<div>' + result.user_hand_list[i][0] +
                            '<div class="jindutiao"><div class="jindutiao_1" style="width:' + (result.user_hand_list[i][1] * grand) + '%"></div></div>' +
                            result.user_hand_list[i][1] + ' / ' + result.task_dict.chenzhuo_award_hand_num + '</div>';
                        $(".modal_wanjia").append(str);
                    }

                } else {
                    alert(result.error)
                }
            }
        });

    });

    // 手数积分排行弹窗
    $(".task_body").on("click", '.myModal_hand_point', function () {

        $("#modal_body_g").attr("class", "")

        var task_list = $(this).find(".task_list").val();
        var data = eval('(' + HtmlUtil.htmlDecode(task_list).replace(/u'/g, "'") + ')');
        $("#length_g").val($(this).find(".length_g2").val());
        console.log(data)
        $("#myModal").modal();
        $.ajax({
            type: 'POST',
            url: "{% url 'hand_point_task_detail' %}",
            data: {
                uid: uid,
                lang: lang,
                channel: channel,
                version: version,
                access_token: access_token,
                config_id: data.config_id,
                is_yesterday: data.is_yesterday,
            },
            success: function (result) {
                console.log(result);
                if (result.ret == 0) {

                    $(".modal_").hide();
                    $(".modal_top_1").html(result.task_dict.task_name);
                    $(".modal_top_2").html(result.task_dict.task_detail_desc);

                    $(".shoushu_biaoge").show();
                    // 排行榜
                    $("#tbody_v1").empty();
                    $("#tbody_v1").append('<div class="tbody_tr" style="color:#FFCC00">' +
                        '<div class="tbody_td">' + result.task_dict.reward_id + '</div>' +
                        '<div class="tbody_td">' + result.task_dict.nickname + '</div>' +
                        '<div class="tbody_td">' + result.task_dict.progress_val + '</div>' +
                        '<div class="tbody_td">' + result.task_dict.reward_desc + '</div>' +
                        '</div>');
                    for (var key in result.task_dict.rank_list) {
                        tab = '<div class="tbody_tr">' +
                            '<div class="tbody_td">' + result.task_dict.rank_list[key].reward_id + '</div>' +
                            '<div class="tbody_td">' + result.task_dict.rank_list[key].nickname + '</div>' +
                            '<div class="tbody_td">' + result.task_dict.rank_list[key].point + '</div>' +
                            '<div class="tbody_td">' + result.task_dict.rank_list[key].reward_desc + '</div>' +
                            '</div>';
                        $("#tbody_v1").append(tab);
                    }

                    // 奖励表
                    $("#tbody_v2").empty();
                    for (var key in result.task_dict.award_table) {
                        tab = '<div class="tbody_tr">' +
                            '<div class="tbody_td">' + result.task_dict.award_table[key].blind_desc + '</div>' +
                            '<div class="tbody_td">' + result.task_dict.award_table[key].pool_type_desc + '</div>' +
                            '<div class="tbody_td">' + result.task_dict.award_table[key].hand_point_num + '</div>' +
                            '<div class="tbody_td">' + result.task_dict.award_table[key].rank_limit_desc + '</div>' +
                            '<div class="tbody_td">' + result.task_dict.award_table[key].hand_point_limit + '</div>' +
                            '</div>';
                        $("#tbody_v2").append(tab);
                    }

                    // 按钮 和 区分展示
                    if (result.task_dict.task_state == 2) {
                        $(".modal_btn").html('<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">领取</div>');
                        $(".modal_jifen_jiangli").html("我的积分：" + result.task_dict.progress_val).show();
                        $(".modal_jiangli").html("我的奖励：" + result.task_dict.reward_desc).show();
                    } else if (result.task_dict.task_state == 3) {
                        $(".modal_btn").html('<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">已完成</div>');
                        $(".modal_jifen_jiangli").html("我的积分：" + result.task_dict.progress_val).show();
                        $(".modal_jiangli").html("我的奖励：" + result.task_dict.reward_desc).show();
                    } else {
                        $(".modal_btn").html('');
                        $(".modal_hand_data").show();
                        $("#modal_end_time_v2").show();
                        if (result.task_dict.show_type == 1) {
                            $(".low_progress_val").html("榜内最低积分：" + result.task_dict.low_progress_val).show();
                            $(".low_reward_desc").html("对应奖励：" + result.task_dict.low_reward_desc).show();
                        } else if (result.task_dict.show_type == 3) {
                            $(".front_progress_val").html("上一名积分：" + result.task_dict.front_progress_val).show();
                            $(".front_reward_desc").html("上一名奖励：" + result.task_dict.front_reward_desc).show();
                        }
                        $(".modal_jifen_jiangli_v2").html("我的积分：" + result.task_dict.progress_val).show();
                        $(".modal_jiangli_v2").html("我的奖励：" + result.task_dict.reward_desc).show();

                    }
                    $("#grand_list").val(JSON.stringify(result.task_dict));
                    $(".modal_btn").attr("onclick", 'jumpClick(0)').show();
                    $(".modal_btn").attr("class", 'modal_btn btn_' + result.task_dict.unique_id);

                    //自定义结束时间 倒计时
                    var timedate = result.task_dict.task_exit_time * 1000

                    function myFunction_v2(stop) {
                        if (stop != 1) {
                            var nowDate = new Date();
                            var EndDate = new Date("2020-10-01 00:00:00") // 无用
                            var dateDiff = parseInt(timedate - nowDate.valueOf())
                            if (dateDiff <= 0) {
                                //myFunction_v2(1);
                                $("#modal_end_time_v2").html("当前任务已结束");
                                return
                            }
                            var days = Math.floor(dateDiff / (24 * 3600 * 1000)) //计算出天数
                            //计算出小时数
                            var leave1 = dateDiff % (24 * 3600 * 1000)  //计算天数后剩余的毫秒数
                            var hours = Math.floor(leave1 / (3600 * 1000))
                            //计算相差分钟数
                            var leave2 = leave1 % (3600 * 1000)    //计算小时数后剩余的毫秒数
                            var minutes = Math.floor(leave2 / (60 * 1000))
                            //计算相差秒数
                            var leave3 = leave2 % (60 * 1000)   //计算分钟数后剩余的毫秒数
                            var seconds = Math.round(leave3 / 1000)
                            //调用checkTime方法将数字小于10的在前面补0
                            days = checkTime(days);
                            hours = checkTime(hours);
                            minutes = checkTime(minutes);
                            seconds = checkTime(seconds);
                            var x = document.getElementById("modal_end_time_v2");
                            x.innerHTML = "当前刷新倒计时：" + hours + ":" + minutes + ":" + seconds;
                            t = setTimeout(function () {
                                myFunction_v2(), 1000
                            })
                        }
                    }

                    function checkTime(i) {
                        if (i < 10 && i != 0) {
                            i = "0" + i;
                        }
                        return i;
                    }

                    myFunction_v2()

                } else {
                    alert(result.error)
                }
            }
        });

    });

    // 幸运手牌弹窗
    $(".task_body").on("click", '.myModal_lucky_poker', function () {

        $("#modal_body_g").attr("class", "modal_body_g")

        var task_list = $(this).find(".task_list").val();
        var data = eval('(' + HtmlUtil.htmlDecode(task_list).replace(/u'/g, "'") + ')');
        $("#length_g").val($(this).find(".length_g2").val());
        console.log(data)
        $("#myModal").modal();
        $.ajax({
            type: 'POST',
            url: "{% url 'lucky_poker_task_detail' %}",
            data: {
                uid: uid,
                lang: lang,
                channel: channel,
                version: version,
                access_token: access_token,
                config_id: data.config_id,
                is_yesterday: data.is_yesterday,
            },
            success: function (result) {
                console.log(result)
                if (result.ret == 0) {

                    $(".modal_").hide();
                    $(".renwu_jindu").show();
                    $(".modal_top_1").html(result.task_dict.task_name +
                        '<img class="img_card" src="{{ request.MEDIA_CDN }}/static/img/task/poker/' + result.task_dict.card_1 + '.png?v=1.0">' +
                        '<img class="img_card" src="{{ request.MEDIA_CDN }}/static/img/task/poker/' + result.task_dict.card_2 + '.png?v=1.0">'
                    );
                    $(".modal_top_2").html(result.task_dict.task_detail_desc);
                    $(".modal_jifen_jiangli").html("累计奖励：" + result.task_dict.reward_total).show();
                    $(".modal_jiangli").html("可领奖励：" + result.task_dict.can_reward_desc).show();
                    $("#modal_end_time").show();

                    //$(".modal_zhouqi").html("当前任务结束时间：" + format(result.task_dict.task_exit_time)).show();
                    if (result.task_dict.task_state == 2) {
                        $(".modal_btn").html('<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">领取</div>');
                    } else if (result.task_dict.task_state == 3) {
                        $(".modal_btn").html('<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">已完成</div>');
                    } else {
                        $(".modal_btn").html('');
                    }
                    $("#grand_list").val(JSON.stringify(result.task_dict));
                    $(".modal_btn").attr("onclick", 'jumpClick(0)').show();
                    $(".modal_btn").attr("class", 'modal_btn btn_' + result.task_dict.unique_id);

                    // 进度条
                    var grand = 99 / result.max_condition_value;
                    if ((result.task_dict.max_progress_val * grand) > 100) {
                        var margin_left = 100;
                    } else {
                        var margin_left = result.task_dict.max_progress_val * grand;
                    }
                    $('.div_progress_val').css({"margin-left": margin_left + "%"});
                    $(".div_progress_val_1").html("当前达成次数");
                    $(".div_progress_val_2").html(result.task_dict.max_progress_val + "次");
                    $('.sp_jindu_1').css({"width": margin_left + "%"});
                    $('.sp_jindu_3').css({"padding-left": margin_left + "%"});
                    $(".sp_jindu_2").empty();
                    for (var i in result.award_list) {

                        if (result.award_list[i][0] < result.task_dict.max_progress_val) {
                            var color = "background-color: #FFCC00;"
                        } else {
                            var color = ""
                        }

                        str = '<div class="sp_jindu_2_1" style="margin-left:' + result.award_list[i][0] * grand + '%">' +
                            '<div class="sp_jindu_2_1_1" style="' + color + '"></div>' +
                            '<div class="sp_jindu_2_1_2">' + result.award_list[i][0] + '次</div>' +
                            '<div>' + result.award_list[i][1] + '</div>' +
                            '</div>';

                        $(".sp_jindu_2").append(str);
                    }
                    if (result.task_dict.max_progress_val > 0) {
                        var color_v2 = "background-color: #FFCC00;"
                    } else {
                        var color_v2 = ""
                    }
                    $(".sp_jindu_2").append('<div class="sp_jindu_2_1" style="margin-left:0%">' +
                        '<div class="sp_jindu_2_1_1" style="' + color_v2 + '"></div>' +
                        '<div class="sp_jindu_2_1_2">0</div>' +
                        '<div>0</div>' +
                        '</div>');

                    //自定义结束时间 倒计时
                    var timedate = result.task_dict.task_exit_time * 1000

                    function myFunction(stop) {
                        if (stop != 1) {
                            var nowDate = new Date();
                            var EndDate = new Date("2020-10-01 00:00:00")
                            var dateDiff = parseInt(timedate - nowDate.valueOf())
                            if (dateDiff <= 0) {
                                myFunction(1);
                                $("#modal_end_time").hide();
                                return
                            }
                            var days = Math.floor(dateDiff / (24 * 3600 * 1000)) //计算出天数
                            //计算出小时数
                            var leave1 = dateDiff % (24 * 3600 * 1000)  //计算天数后剩余的毫秒数
                            var hours = Math.floor(leave1 / (3600 * 1000))
                            //计算相差分钟数
                            var leave2 = leave1 % (3600 * 1000)    //计算小时数后剩余的毫秒数
                            var minutes = Math.floor(leave2 / (60 * 1000))
                            //计算相差秒数
                            var leave3 = leave2 % (60 * 1000)   //计算分钟数后剩余的毫秒数
                            var seconds = Math.round(leave3 / 1000)
                            //调用checkTime方法将数字小于10的在前面补0
                            days = checkTime(days);
                            hours = checkTime(hours);
                            minutes = checkTime(minutes);
                            seconds = checkTime(seconds);
                            var x = document.getElementById("modal_end_time");
                            x.innerHTML = "当前任务倒计时：" + hours + ":" + minutes + ":" + seconds;
                            t = setTimeout(function () {
                                myFunction(), 1000
                            })
                        }
                    }

                    function checkTime(i) {
                        if (i < 10 && i != 0) {
                            i = "0" + i;
                        }
                        return i;
                    }

                    myFunction()

                } else {
                    alert(result.error)
                }
            }
        });

    });

    // 新手任务弹窗
    $(".task_body").on("click", '.myModal_new_user', function () {

        $("#modal_body_g").attr("class", "modal_body_g")

        var task_list = $(this).find(".task_list").val();
        var data = eval('(' + HtmlUtil.htmlDecode(task_list).replace(/u'/g, "'") + ')');
        console.log(data)
        if (data.task_state == 3) {
            $(".modal_dialog_error").html("任务已完成");
            $("#myModal_error").modal();
            setTimeout(function () {
                $("#myModal_error").modal("hide");
            }, 2000);
            return false
        }
        $("#myModal").modal();
        $.ajax({
            type: 'POST',
            url: "{% url 'new_user_task_detail' %}",
            data: {
                uid: uid,
                lang: lang,
                channel: channel,
                version: version,
                access_token: access_token,
                config_id: data.config_id,
            },
            success: function (result) {
                console.log(result)
                if (result.ret == 0) {
                    $(".modal_").hide();
                    $(".renwu_jindu").show();
                    $(".modal_top_1").html(result.task_data.task_name);
                    $(".modal_top_2").html(result.task_data.task_title);

                    $(".modal_jiangli").html("达成奖励：" + result.task_data.reward_desc).show();
                    $(".modal_zhouqi").html(result.task_data.bottom_desc).show();

                    // 按钮
                    if (result.task_data.task_state == 2) {
                        $(".modal_btn").html('<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">领取</div>');
                    } else if (result.task_data.task_state == 3) {
                        $(".modal_btn").html('<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">已完成</div>');
                    } else {
                        $(".modal_btn").html('');
                    }
                    $("#grand_list").val(JSON.stringify(result.task_data));
                    $(".modal_btn").attr("onclick", 'jumpClick(1)').show();
                    $(".modal_btn").attr("class", 'modal_btn btn_' + result.task_data.unique_id);

                    // 进度条
                    var grand = 99 / result.task_data.condition_value;
                    if ((result.task_data.progress_val * grand) > 100) {
                        var margin_left = 100;
                    } else {
                        var margin_left = result.task_data.progress_val * grand
                    }
                    $('.div_progress_val').css({"margin-left": margin_left + "%"});
                    if (result.task_data.task_official_type == 5 || result.task_data.task_official_type == 2) {
                        var new_unit = "天"
                    } else if (result.task_data.task_official_type == 26) {
                        var new_unit = "个"
                    } else if (result.task_data.task_official_type == 18 || result.task_data.task_official_type == 23) {
                        var new_unit = "元"
                    } else if (result.task_data.task_official_type == 29) {
                        var new_unit = "手"
                    } else {
                        var new_unit = "次"
                    }
                    if (result.task_data.task_official_type == 10 || result.task_data.task_official_type == 11) {
                        $(".div_progress_val_1").html("当前获胜" + new_unit + "数");
                    } else {
                        $(".div_progress_val_1").html("当前完成" + new_unit + "数");
                    }
                    $(".div_progress_val_2").html(result.task_data.progress_val + new_unit);
                    $('.sp_jindu_1').css({"width": margin_left + "%"});
                    $('.sp_jindu_3').css({"padding-left": margin_left + "%"});
                    $(".sp_jindu_2").empty();
                    if (result.task_data.progress_val > 0) {
                        var color_v2 = "background-color: #FFCC00;"
                    } else {
                        var color_v2 = ""
                    }
                    if (result.task_data.progress_val >= result.task_data.condition_value) {
                        var color_v3 = "background-color: #FFCC00;"
                    } else {
                        var color_v3 = ""
                    }
                    if (result.task_data.progress_val == 0 || result.task_data.progress_val == result.task_data.condition_value) {
                        var progress_val_ = ""
                    } else {
                        var progress_val_ = result.task_data.progress_val + new_unit
                    }
                    $(".sp_jindu_2").append('<div class="sp_jindu_2_1" style="margin-left:0%">' +
                        '<div class="sp_jindu_2_1_1" style="' + color_v2 + '"></div>' +
                        '<div class="sp_jindu_2_1_2">0' + new_unit + '</div>' +
                        '<div></div>' +
                        '</div>');
                    $(".sp_jindu_2").append('<div class="sp_jindu_2_1" style="margin-left:99%">' +
                        '<div class="sp_jindu_2_1_1" style="' + color_v3 + '"></div>' +
                        '<div class="sp_jindu_2_1_2">' + result.task_data.condition_value + new_unit + '</div>' +
                        '<div></div>' +
                        '</div>');
                    $(".sp_jindu_2").append('<div class="sp_jindu_2_1" style="margin-left:' + margin_left + '%">' +
                        '<div class="sp_jindu_2_1_1" style="' + color_v2 + '"></div>' +
                        '<div class="sp_jindu_2_1_2">' + progress_val_ + '</div>' +
                        '<div></div>' +
                        '</div>');


                } else {
                    alert(result.error)
                }
            }
        });

    });

    // 官方任务弹窗
    $(".task_body").on("click", '.myModal_official', function () {

        $("#modal_body_g").attr("class", "modal_body_g")

        var task_list = $(this).find(".task_list").val();
        var data = eval('(' + HtmlUtil.htmlDecode(task_list).replace(/u'/g, "'") + ')');
        console.log(data)
        if (data.task_state == 3) {
            $(".modal_dialog_error").html("任务已完成");
            $("#myModal_error").modal();
            setTimeout(function () {
                $("#myModal_error").modal("hide");
            }, 2000);
            return false
        }
        $("#myModal").modal();
        $.ajax({
            type: 'POST',
            url: "{% url 'official_task_detail' %}",
            data: {
                uid: uid,
                lang: lang,
                channel: channel,
                version: version,
                access_token: access_token,
                config_id: data.config_id,
            },
            success: function (result) {
                console.log(result)
                if (result.ret == 0) {
                    $(".modal_").hide();
                    $(".renwu_jindu").show();
                    $(".modal_top_1").html(result.task_data.task_name);
                    $(".modal_top_2").html(result.task_data.task_detail_desc);

                    $(".modal_jiangli").html("累计返利：￥" + result.task_data.award_num).show();

                    // 按钮
                    if (result.task_data.task_state == 2) {
                        $(".modal_btn").html('<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">领取</div>');
                        $(".modal_zhouqi").html("活动周期：" + result.task_data.start_date + " - " + result.task_data.end_date + ",可领取当日产生的流水返利").show();
                    } else if (result.task_data.task_state == 3) {
                        $(".modal_btn").html('<img src="{{ request.MEDIA_CDN }}/static/img/task/game/btn_yellow.png?v=1.0"><div style="color:#000">已完成</div>');
                    } else {
                        $(".modal_btn").html('');
                        $(".modal_zhouqi").html("活动周期：" + result.task_data.start_date + " - " + result.task_data.end_date + ",满" + result.task_data.act_date + "日可领取所有流水返利").show();
                    }
                    $("#grand_list").val(JSON.stringify(result.task_data));
                    $(".modal_btn").attr("onclick", 'jumpClick(3)').show();
                    $(".modal_btn").attr("class", 'modal_btn btn_' + result.task_data.unique_id);

                    // 进度条
                    if (result.task_data.task_official_type == 2) {

                        $(".modal_jifen_jiangli").html("（当前返利比例：" + result.task_data.rebate_ratio + "‰）").show();

                        var grand = 99 / result.task_data.max_condition_value;
                        if ((result.task_data.total_values * grand) > 100) {
                            var margin_left = 100;
                        } else {
                            var margin_left = result.task_data.total_values * grand
                        }
                        $('.div_progress_val').css({"margin-left": margin_left + "%"});
                        $(".div_progress_val_1").html("累计下注流水");
                        if (result.task_data.total_values >= 10000) {
                            var total_values_g = (result.task_data.total_values / 10000) + 'w';
                        } else {
                            var total_values_g = result.task_data.total_values
                        }
                        $(".div_progress_val_2").html(total_values_g);
                        $('.sp_jindu_1').css({"width": margin_left + "%"});
                        $('.sp_jindu_3').css({"padding-left": margin_left + "%"});
                        $(".sp_jindu_2").empty();
                        for (var foo in result.task_data.condition_value_list) {

                            var color_g = "";
                            if (parseInt(result.task_data.condition_value_list[foo][0]) < parseInt(result.task_data.total_values)) {
                                color_g = "background-color: #FFCC00;"
                            }

                            if (result.task_data.condition_value_list[foo][0] >= 10000) {
                                var condition_value = (result.task_data.condition_value_list[foo][0] / 10000) + 'w';
                            } else {
                                var condition_value = result.task_data.condition_value_list[foo][0]
                            }

                            str = '<div class="sp_jindu_2_1" style="margin-left:' + result.task_data.condition_value_list[foo][0] * grand + '%">' +
                                '<div class="sp_jindu_2_1_1" style="' + color_g + '"></div>' +
                                '<div class="sp_jindu_2_1_2">' + condition_value + '</div>' +
                                '<div>' + result.task_data.condition_value_list[foo][1] + '‰</div>' +
                                '</div>';

                            $(".sp_jindu_2").append(str);
                        }
                        if (result.task_data.total_values > 0) {
                            var color_v2 = "background-color: #FFCC00;"
                        } else {
                            var color_v2 = ""
                        }
                        $(".sp_jindu_2").append('<div class="sp_jindu_2_1" style="margin-left:0%">' +
                            '<div class="sp_jindu_2_1_1" style="' + color_v2 + '"></div>' +
                            '<div class="sp_jindu_2_1_2">0</div>' +
                            '<div>0</div>' +
                            '</div>');
                    } else {
                        var grand = 99 / result.task_data.act_date;
                        if ((result.task_data.pass_days * grand) > 100) {
                            var margin_left = 100;
                        } else {
                            var margin_left = result.task_data.pass_days * grand
                        }
                        $('.div_progress_val').css({"margin-left": margin_left + "%"});
                        $(".div_progress_val_1").html("当日返利");
                        $(".div_progress_val_2").html("￥" + result.task_data.cur_day_rebate);
                        $('.sp_jindu_1').css({"width": margin_left + "%"});
                        $('.sp_jindu_3').css({"padding-left": margin_left + "%"});
                        $(".sp_jindu_2").empty();
                        if (result.task_data.pass_days == 0 || result.task_data.pass_days >= result.task_data.act_date) {
                            var cur_date_ = ""
                        } else {
                            var cur_date_ = result.task_data.cur_date
                        }
                        $(".sp_jindu_2").append('<div class="sp_jindu_2_1" style="margin-left:0%">' +
                            '<div class="sp_jindu_2_1_1" style="background-color: #FFCC00;"></div>' +
                            '<div class="sp_jindu_2_1_2">' + result.task_data.start_date + '</div>' +
                            '<div></div>' +
                            '</div>');
                        $(".sp_jindu_2").append('<div class="sp_jindu_2_1" style="margin-left:99%">' +
                            '<div class="sp_jindu_2_1_1"></div>' +
                            '<div class="sp_jindu_2_1_2">' + result.task_data.end_date + '</div>' +
                            '<div></div>' +
                            '</div>');
                        $(".sp_jindu_2").append('<div class="sp_jindu_2_1" style="margin-left:' + margin_left + '%">' +
                            '<div class="sp_jindu_2_1_1"></div>' +
                            '<div class="sp_jindu_2_1_2">' + cur_date_ + '</div>' +
                            '<div></div>' +
                            '</div>');
                    }

                } else {
                    alert(result.error)
                }
            }
        });

    });

    // 新手任务任务待解锁提示
    $(".task_body").on("click", '.myModal_new_user_is_no', function () {
        // 错误动画
        $(".modal_dialog_error").html("任务待解锁");
        $("#myModal_error").modal();
        setTimeout(function () {
            $("#myModal_error").modal("hide");
        }, 2000);
    });

    // 彩池总览函数，客户端调用触发
    function changePoolNum(val) {
        //String转字符串，padStart不够七位就往前面加0
        //var grand = (String(val)).padStart(5, '0');
        {#var grand_1 = grand.substring(0, 1)#}
        {#var grand_2 = grand.substring(1, 2)#}
        {#var grand_3 = grand.substring(2, 3)#}
        {#var grand_4 = grand.substring(3, 4)#}
        {#var grand_5 = grand.substring(4, 5)#}
        {#$(".pool_img_1").attr("src", "{{ request.MEDIA_CDN }}/static/img/task/game/number/" + grand_1 + ".png");#}
        {#$(".pool_img_2").attr("src", "{{ request.MEDIA_CDN }}/static/img/task/game/number/" + grand_2 + ".png");#}
        {#$(".pool_img_3").attr("src", "{{ request.MEDIA_CDN }}/static/img/task/game/number/" + grand_3 + ".png");#}
        {#$(".pool_img_4").attr("src", "{{ request.MEDIA_CDN }}/static/img/task/game/number/" + grand_4 + ".png");#}
        {#$(".pool_img_5").attr("src", "{{ request.MEDIA_CDN }}/static/img/task/game/number/" + grand_5 + ".png");#}

        var nums = String(val);
        var array = nums.split("");
        console.log(array)
        $(".pool_number_v").empty();
        $(".pool_number_v").append('<img src="{{ request.MEDIA_CDN }}/static/img/task/game/number/money.png?v=1.0">');
        for (var key in array) {
            str = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/number/' + array[key] + '.png?v=1.0">'
            $(".pool_number_v").append(str);
        }


    }

    //页面进来默认调用后端给我的
    {% if request.GET.pool_type|add:0 == 1 %}
        $("#caichi_level").html("小彩池");
        changePoolNum("{{ pool_amount_small }}");
    {% elif request.GET.pool_type|add:0 == 2 %}
        $("#caichi_level").html("中彩池");
        changePoolNum("{{ pool_amount_medium }}");
    {% else %}
        $("#caichi_level").html("大彩池");
        changePoolNum("{{ pool_amount_big }}");
    {% endif %}

    // 彩池总览函数，我调用客户端的弹窗，没有参数
    $(".pool_number").click(function () {
        var u = navigator.userAgent,
            app = navigator.appVersion;
        var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //android终端或者uc浏览器
        var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
        if (isAndroid) {
            window.android.showPoolsOverview();
        } else {
            window.webkit.messageHandlers.showPoolsOverview.postMessage({});
        }
    });

    // 返回后加载任务，客户端调用触发
    function refreshData() {
        var tab_type = $("#tab_type").val();
        $("#myModal").modal("hide");
        task_master_list(tab_type);
        //让滚动条到顶部
        document.documentElement.scrollTop = document.body.scrollTop = 0 - 0;
    }

    // 彩池总览，弹窗
    $("#caichi_zonglan").click(function () {
        $("#myModal_caichi_zonglan").modal();
        $.ajax({
            type: 'POST',
            url: "{% url 'lottery_pool_overview' %}",
            data: {
                uid: uid,
                lang: lang,
                channel: channel,
                version: version,
            },
            success: function (result) {
                console.log(result)
                if (result.ret == 0) {

                    var nums = String(result.ret_data.pool_amount_total);
                    var array = nums.split("");
                    $(".zonglan_zongcaichi_img").empty();
                    $(".zonglan_zongcaichi_img").append('<img src="{{ request.MEDIA_CDN }}/static/img/task/game/number/money.png?v=1.0">');
                    for (var key in array) {
                        str = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/number/' + array[key] + '.png?v=1.0">'
                        $(".zonglan_zongcaichi_img").append(str);
                    }

                    var nums_small = String(result.ret_data.pool_amount_small);
                    var array_small = nums_small.split("");
                    $(".zonglan_xiaocaichi_img").empty();
                    $(".zonglan_xiaocaichi_img").append('<img src="{{ request.MEDIA_CDN }}/static/img/task/game/number/money.png?v=1.0">');
                    for (var key in array_small) {
                        str = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/number/' + array_small[key] + '.png?v=1.0">'
                        $(".zonglan_xiaocaichi_img").append(str);
                    }

                    var nums_medium = String(result.ret_data.pool_amount_medium);
                    var array_medium = nums_medium.split("");
                    $(".zonglan_zhongcaichi_img").empty();
                    $(".zonglan_zhongcaichi_img").append('<img src="{{ request.MEDIA_CDN }}/static/img/task/game/number/money.png?v=1.0">');
                    for (var key in array_medium) {
                        str = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/number/' + array_medium[key] + '.png?v=1.0">'
                        $(".zonglan_zhongcaichi_img").append(str);
                    }

                    var nums_big = String(result.ret_data.pool_amount_big);
                    var array_big = nums_big.split("");
                    $(".zonglan_dacaichi_img").empty();
                    $(".zonglan_dacaichi_img").append('<img src="{{ request.MEDIA_CDN }}/static/img/task/game/number/money.png?v=1.0">');
                    for (var key in array_big) {
                        str = '<img src="{{ request.MEDIA_CDN }}/static/img/task/game/number/' + array_big[key] + '.png?v=1.0">'
                        $(".zonglan_dacaichi_img").append(str);
                    }

                    $(".lottery_pool_explain").html(result.ret_data.lottery_pool_explain);
                    $(".pool_task_explain").html(result.ret_data.pool_task_explain);
                    $(".official_task_explain").html(result.ret_data.official_task_explain);
                    $(".task_warn_explain").html(result.ret_data.task_warn_explain);


                }


            }
        })

    });


    // 奖励记录，弹窗     .....     无用
    $("#jiangli_jilu-no").click(function () {
        $("#myModal_jiangli_jilu").modal();
        lottery_award(0)
    });

    function lottery_award(from_index, type) {
        $.ajax({
            type: 'POST',
            url: "{% url 'user_lottery_award_list' %}",
            data: {
                uid: uid,
                lang: lang,
                channel: channel,
                version: version,
                from_index: from_index,
            },
            success: function (result) {
                console.log(result)
                if (result.ret == 0) {

                    if (from_index == 0) {
                        $(".jilu_nickname").html(result.ret_data.big_award_info.nickname);
                        $(".jilu_blind_desc").html(result.ret_data.big_award_info.blind_desc);
                        $(".jilu_award_amount").html(result.ret_data.big_award_info.award_amount_h5);
                        $("#wrapper_data").empty();
                        var str_g = '<li class="table_data" style="color:#FFE71A">\n' +
                            '     <div>' + result.ret_data.user_award_info.order_id + '</div>\n' +
                            '     <div>' + result.ret_data.user_award_info.nickname + '</div>\n' +
                            '     <div>' + result.ret_data.user_award_info.award_amount_h5 + '</div>\n' +
                            ' </li>';

                        $("#wrapper_data").append(str_g);
                    }

                    $("#game_from_index").val(result.ret_data.last_index);
                    var list = result.ret_data.lottery_award_list;
                    for (var key in list) {
                        str = '<li class="table_data">\n' +
                            '     <div>' + list[key].order_id + '</div>\n' +
                            '     <div>' + list[key].nickname + '</div>\n' +
                            '     <div>' + list[key].award_amount_h5 + '</div>\n' +
                            ' </li>';
                        $("#wrapper_data").append(str);
                    }

                    if (type == 1) {


                    } else if (type == 2) {

                    }

                }
            }
        })

    }


    refresher.init({
        id: "wrapper",//<------------------------------------------------------------------------------------┐
        pullDownAction: Refresh,
        pullUpAction: Load
    });

    function Refresh() {
        {#$(".scroller").css("margin-top", "0");#}
        lottery_award(0, 1)


        var el, li, i;
        el = document.querySelector("#wrapper ul");
        //这里写你的刷新代码
        document.getElementById("wrapper").querySelector(".pullDownIcon").style.display = "none";
        document.getElementById("wrapper").querySelector(".pullDownLabel").innerHTML = "<img src=\"{{ request.MEDIA_CDN }}/static/load_set/css/ok.png?v=1.0\">刷新成功";
        setTimeout(function () {
            wrapper.refresh();
            document.getElementById("wrapper").querySelector(".pullDownLabel").innerHTML = "";
            {#$(".scroller").css("margin-top", "-40px");#}
        }, 1000);//模拟qq下拉刷新显示成功效果

    }

    function Load() {

        var game_from_index = $("#game_from_index").val();

        lottery_award(game_from_index, 2)


        setTimeout(function () {// <-- Simulate network congestion, remove setTimeout from production!
            var el, li, i;
            el = document.querySelector("#wrapper ul");
            {#for (i = 0; i < 2; i++) {#}
            {#    li = document.createElement('li');#}
            {#    li.innerHTML = "<img src='img/game8.png'><div class='game-info'><h1>华仔超神战记</h1><p>9万次下载     89.18M</p><p>秒杀虚拟摇杆，砸烂手机键盘</p></div><button>下载</button>"#}
            {#    el.appendChild(li, el.childNodes[0]);#}
            {# }#}
            wrapper.refresh();/****remember to refresh after action completed！！！   ---id.refresh(); --- ****/
        }, 2000);

    }


    var btn = document.getElementById('jiangli_jilu');
    var div = document.getElementById('background');
    var close = document.getElementById('close-button');

    btn.onclick = function show() {
        div.style.display = "block";
        lottery_award(0)
    }

    close.onclick = function close() {
        div.style.display = "none";
    }

    window.onclick = function close(e) {
        if (e.target == div) {
            div.style.display = "none";
        }
    }


</script>
<!--<script src="{% static 'js/vue.js' %}"></script>-->
</html>